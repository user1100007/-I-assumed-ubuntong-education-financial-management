<html lang="en"><head><style data-styles="">ion-icon{visibility:hidden}.hydrated{visibility:inherit}</style>
	<meta charset="utf-8">
	<meta name="csrf-token" content="bFuPrwGZILPqAozYW8PljycSmevJGhguauklDMeG">
	<meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
	<meta name="description" content="Dashlead -  Admin Panel HTML Dashboard Template">
	<meta name="author" content="Spruko Technologies Private Limited">
	<meta name="keywords" content="sales dashboard, admin dashboard, bootstrap 4 admin template, html admin template, admin panel design, admin panel design, bootstrap 4 dashboard, admin panel template, html dashboard template, bootstrap admin panel, sales dashboard design, best sales dashboards, sales performance dashboard, html5 template, dashboard template">
	<!-- Title -->

<link rel="icon" href="https://sof.efmsmoeys.com/assets/img/brand/efmslogo.ico" type="image/x-icon">
<title>Education Financial Management System</title>

<!---Fontawesome css-->
<link href="https://sof.efmsmoeys.com/assets/plugins/fontawesome-free/css/all.min.css" rel="stylesheet">

<!---Ionicons css-->
<link href="https://sof.efmsmoeys.com/assets/plugins/ionicons/css/ionicons.min.css" rel="stylesheet">

<!---Typicons css-->
<link href="https://sof.efmsmoeys.com/assets/plugins/typicons.font/typicons.css" rel="stylesheet">

<!---Feather css-->
<link href="https://sof.efmsmoeys.com/assets/plugins/feather/feather.css" rel="stylesheet">

<!---Falg-icons css-->
<link href="https://sof.efmsmoeys.com/assets/plugins/flag-icon-css/css/flag-icon.min.css" rel="stylesheet">

<!--- Waiting css -->
<link href="https://sof.efmsmoeys.com/assets/css/waiting.css" rel="stylesheet">

<!---Style css-->
<link href="https://sof.efmsmoeys.com/assets/css/style.css" rel="stylesheet">
<link href="https://sof.efmsmoeys.com/assets/css/custom-style.css" rel="stylesheet">
<link href="https://sof.efmsmoeys.com/assets/css/custom.css" rel="stylesheet">

<style>
     .tooltip {
          z-index: 9999 ;
     }
     #setting-menu:hover {
          color: #007bff;
     }
     #href:hover {
          cursor: pointer;
          color: #007bff;
     }
    .iconInputForm{
         margin-right: 12px;
         margin-top: -32px;
         float: right;
         cursor: pointer;
    }
</style>

<!--- Waiting css -->
<link href="https://sof.efmsmoeys.com/assets/css/waiting.css" rel="stylesheet">

<link rel="stylesheet" href="https://sof.efmsmoeys.com/assets/css/custom.css">
<!---Select2 css-->
<link href="https://sof.efmsmoeys.com/assets/plugins/select2/css/select2.min.css" rel="stylesheet">

<!---Sweet-Alert css-->
<link href="https://sof.efmsmoeys.com/assets/plugins/sweet-alert/sweetalert.css" rel="stylesheet">
<!--  -->
<link rel="stylesheet" href="https://sof.efmsmoeys.com/izitoast/css/iziToast.min.css">

<!--Mutipleselect css-->
<link rel="stylesheet" href="https://sof.efmsmoeys.com/assets/plugins/multipleselect/multiple-select.css">
<!---Jquery.mCustomScrollbar css-->
<link href="https://sof.efmsmoeys.com/assets/plugins/jquery.mCustomScrollbar/jquery.mCustomScrollbar.css" rel="stylesheet">


<!---Sidebar css-->
<link href="https://sof.efmsmoeys.com/assets/plugins/sidebar/sidebar.css" rel="stylesheet">

<!---Sidemenu css-->
<link href="https://sof.efmsmoeys.com/assets/plugins/sidemenu/sidemenu.css" rel="stylesheet">

<!--  -->
<link rel="stylesheet" href="https://sof.efmsmoeys.com/izitoast/css/iziToast.min.css"><script src="https://sof.efmsmoeys.com/assets/plugins/ionicons/ionicons/ionicons.suuqn5vt.js" type="module" crossorigin="true" data-resources-url="https://sof.efmsmoeys.com/assets/plugins/ionicons/ionicons/" data-namespace="ionicons"></script><style type="text/css">/* Chart.js */
@-webkit-keyframes chartjs-render-animation{from{opacity:0.99}to{opacity:1}}@keyframes chartjs-render-animation{from{opacity:0.99}to{opacity:1}}.chartjs-render-monitor{-webkit-animation:chartjs-render-animation 0.001s;animation:chartjs-render-animation 0.001s;}</style></head>

<body class="main-sidebar-hide">
<!-- Loader -->
    <div class="container-fluid waiting-hover">
    <div class="col-lg-4 waiting-container card custom-card">
        <div class="card-body">
            
            <div class="card-body">
                <div class="text-center">
                    <div class="lds-spinner"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- End Loader -->
<!-- Page -->
<div class="page">

<!-- additional icon link -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css">
<link href="https://sof.efmsmoeys.com/assets/plugins/bootstrap-icons-1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">

<div class="main-sidebar main-sidebar-sticky side-menu ps ps--active-y">
    <div class="sidemenu-logo">
        <a class="main-logo" href="https://sof.efmsmoeys.com/sof">
            <img src="https://sof.efmsmoeys.com/assets/img/brand/logo.png" class="header-brand-img desktop-logo" alt="logo">
            <img src="https://sof.efmsmoeys.com/assets/img/brand/logo.png" class="header-brand-img icon-logo" alt="logo">
            <img src="https://sof.efmsmoeys.com/assets/img/brand/logo.png" class="header-brand-img desktop-logo theme-logo" alt="logo">
            <img src="https://sof.efmsmoeys.com/assets/img/brand/logo.png" class="header-brand-img icon-logo theme-logo" alt="logo">
        </a>
    </div>
    <div class="main-sidebar-body">
        <ul class="nav">
            
            <li class="nav-item active">
                <a class="nav-link" href="https://sof.efmsmoeys.com/sof" data-placement="right" side-menu-data-toggle="tooltip" title="" data-original-title="Dashboard">
                    <i class="bi bi-house"></i>
                    <span class="sidemenu-label text-truncate">Dashboard</span>
                </a>
            </li>
                            <li class="nav-item">
            <a class="nav-link with-sub" href="" data-placement="right" side-menu-data-toggle="tooltip" title="" data-original-title="Budget Plan Preparation">
                <i class="bi bi-map"></i>
                <span class="sidemenu-label text-truncate">Budget Plan Preparation</span>
                <i class="angle fe fe-chevron-right"></i>
            </a>
            <ul class="nav-sub">
                                <li class="nav-item ">
                    <a class="nav-link" href="https://sof.efmsmoeys.com/sof/budget_celling" data-placement="right" side-menu-data-toggle="tooltip" title="" data-original-title="Budget Ceiling">
                        <i class="bi bi-journal-text"></i>
                        <span class="sidemenu-label text-truncate">Budget Ceiling</span>
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="https://sof.efmsmoeys.com/sof/budget_plan" data-placement="right" side-menu-data-toggle="tooltip" title="" data-original-title="Annual Budget Planning">
                        <i class="bi bi-calendar2-plus"></i>
                        <span class="sidemenu-label text-truncate">Annual Budget Planning</span>
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="https://sof.efmsmoeys.com/sof/meeting_plan" data-placement="right" side-menu-data-toggle="tooltip" title="" data-original-title="Meeting Budget Planing">
                        <i class="bi bi-calendar-date"></i>
                        <span class="sidemenu-label text-truncate">Meeting Budget Planing</span>
                    </a>
                </li>
                
                <li class="nav-item ">
                    <a class="nav-link" href="https://sof.efmsmoeys.com/sof/bsp_indicator" data-placement="right" side-menu-data-toggle="tooltip" title="" data-original-title="Performance Indicator and Target">
                        <i class="bi bi-bullseye"></i>
                        <span class="sidemenu-label text-truncate">Performance Indicator and Target</span>
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="https://sof.efmsmoeys.com/sof/bsp" data-placement="right" side-menu-data-toggle="tooltip" title="" data-original-title="ផែនការយុទ្ធសាស្រ្តថវិកា">
                        <i class="bi bi-window"></i>
                        <span class="sidemenu-label text-truncate">ផែនការយុទ្ធសាស្រ្តថវិកា</span>
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="https://sof.efmsmoeys.com/sof/aop" data-placement="right" side-menu-data-toggle="tooltip" title="" data-original-title="Annual Operating Plan">
                        <i class="bi bi-calendar-month"></i>
                        <span class="sidemenu-label text-truncate">Annual Operating Plan</span>
                    </a>
                </li>
            </ul>
        </li>
    
    
    
            <li class="nav-item">
            <a class="nav-link with-sub" href="" data-placement="right" side-menu-data-toggle="tooltip" title="" data-original-title="Budget Allocation">
                <i class="bi bi-book"></i>
                <span class="sidemenu-label text-truncate">Budget Allocation</span>
                <i class="angle fe fe-chevron-right"></i>
            </a>
            <ul class="nav-sub">
                
                <li class="nav-item">
                    <a class="nav-link with-sub" href="" data-placement="right" side-menu-data-toggle="tooltip" title="" data-original-title="Remaining Budget">
                        <i class="bi bi-collection"></i>
                        <span class="sidemenu-label text-truncate">Remaining Budget</span>
                        <i class="angle fe fe-chevron-right"></i>
                    </a>
                    <ul class="nav-sub">
                        
                        <li class="nav-item ">
                            <a class="nav-link" href="https://sof.efmsmoeys.com/sof/remain/budget_law" data-placement="right" side-menu-data-toggle="tooltip" title="" data-original-title="Old year loan">
                                <i class="bi bi-wallet2"></i>
                                <span class="sidemenu-label text-truncate">Old year loan</span>
                            </a>
                        </li>
                        
                        <li class="nav-item ">
                            <a class="nav-link" href="https://sof.efmsmoeys.com/sof/receipt/prev_remaining_budget" data-placement="right" side-menu-data-toggle="tooltip" title="" data-original-title="Remaining Budget Last Year">
                                <i class="bi bi-wallet2"></i>
                                <span class="sidemenu-label text-truncate">Remaining Budget Last Year</span>
                            </a>
                        </li>
                    </ul>
                </li>
                
                <li class="nav-item ">
                    <a class="nav-link" href="https://sof.efmsmoeys.com/sof/early/budget_law" data-placement="right" side-menu-data-toggle="tooltip" title="" data-original-title="Early Budget">
                        <i class="bi bi-wallet"></i>
                        <span class="sidemenu-label text-truncate">Early Budget</span>
                    </a>
                </li>
                
                <li class="nav-item ">
                    <a class="nav-link" href="https://sof.efmsmoeys.com/sof/revised/budget_law" data-placement="right" side-menu-data-toggle="tooltip" title="" data-original-title="Revised Budget">
                        <i class="bi bi-wallet2"></i>
                        <span class="sidemenu-label text-truncate">Revised Budget</span>
                    </a>
                </li>
            </ul>
        </li>
    
    
            <li class="nav-item">
            <a class="nav-link with-sub" href="" data-placement="right" side-menu-data-toggle="tooltip" title="" data-original-title="Budget Execution/Implementation">
                <i class="bi bi-pie-chart"></i>
                <span class="sidemenu-label text-truncate">Budget Execution/Implementation</span>
                <i class="angle fe fe-chevron-right"></i>
            </a>
            <ul class="nav-sub">
                
                                    
                    <li class="nav-item ">
                                                <a id="href" class="nav-link" data-placement="right" side-menu-data-toggle="tooltip" title="" onclick="createUploadReport('https://sof.efmsmoeys.com/sof/report_upload/create')" data-original-title="Upload Excel System ">
                            <i class="bi bi-cloud-upload"></i>
                            <span class="sidemenu-label text-truncate"> Upload Excel System </span>
                        </a>
                    </li>
                                <li class="nav-item ">
                    <a class="nav-link" href="https://sof.efmsmoeys.com/sof/receipt" data-placement="right" side-menu-data-toggle="tooltip" title="" data-original-title="Receipt Transaction">
                        <i class="bi bi-folder-plus"></i>
                        <span class="sidemenu-label text-truncate">Receipt Transaction</span>
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="https://sof.efmsmoeys.com/sof/disbursement" data-placement="right" side-menu-data-toggle="tooltip" title="" data-original-title="Disbursement Transaction">
                        <i class="bi bi-folder-minus"></i>
                        <span class="sidemenu-label text-truncate">Disbursement Transaction</span>
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="https://sof.efmsmoeys.com/sof/refund" data-placement="right" side-menu-data-toggle="tooltip" title="" data-original-title="Refund Cash On Hand">
                        <i class="bi bi-arrow-clockwise"></i>
                        <span class="sidemenu-label text-truncate">Refund Cash On Hand</span>
                    </a>
                </li>

                <li class="nav-item ">
                    <a class="nav-link" href="https://sof.efmsmoeys.com/sof/refund_cash_in_bank" data-placement="right" side-menu-data-toggle="tooltip" title="" data-original-title="Cash payment at the bank">
                        <i class="bi bi-folder-minus"></i>
                        <span class="sidemenu-label text-truncate">Cash payment at the bank</span>
                    </a>
                </li>

            </ul>
        </li>
    
    
            <li class="nav-item">
            <a class="nav-link with-sub" href="" data-placement="right" side-menu-data-toggle="tooltip" title="" data-original-title="Material Accounting Regisration">
                <i class="bi bi-window"></i>
                <span class="sidemenu-label text-truncate">Material Accounting Regisration</span>
                <i class="angle fe fe-chevron-right"></i>
            </a>
            <ul class="nav-sub">
                                    <li class="nav-item ">
                                                <a id="href" class="nav-link" data-placement="right" side-menu-data-toggle="tooltip" title="" onclick="createUploadInventory('https://sof.efmsmoeys.com/inventory/upload_inventory/create')" data-original-title="Upload Inventory">
                            <i class="bi bi-cloud-upload"></i>
                            <span class="sidemenu-label text-truncate">Upload Inventory</span>
                        </a>
                    </li>
                                <li class="nav-item ">
                    <a class="nav-link" href="https://sof.efmsmoeys.com/inventory/add" data-placement="right" side-menu-data-toggle="tooltip" title="" data-original-title="Stock In Transaction">
                        <i class="bi bi-cart-plus"></i>
                        <span class="sidemenu-label text-truncate">Stock In Transaction</span>
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="https://sof.efmsmoeys.com/inventory/inventory.release" data-placement="right" side-menu-data-toggle="tooltip" title="" data-original-title="Stock Out Transaction">
                        <i class="bi bi-cart-dash"></i>
                        <span class="sidemenu-label text-truncate">Stock Out Transaction</span>
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="https://sof.efmsmoeys.com/inventory/inventory.analysis" data-placement="right" side-menu-data-toggle="tooltip" title="" data-original-title="Inventory Analysis">
                        <i class="bi bi-bar-chart"></i>
                        <span class="sidemenu-label text-truncate">Inventory Analysis</span>
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="https://sof.efmsmoeys.com/inventory/inventory.stock" data-placement="right" side-menu-data-toggle="tooltip" title="" data-original-title="Inventory Closing Entry">
                        <i class="bi bi-list-task"></i>
                        <span class="sidemenu-label text-truncate">Inventory Closing Entry</span>
                    </a>
                </li>
                            </ul>
        </li>
        <li class="nav-item">
        <a class="nav-link with-sub" href="" data-placement="right" side-menu-data-toggle="tooltip" title="" data-original-title="Cash Book and Statement">
            <i class="bi bi-bar-chart"></i>
            <span class="sidemenu-label text-truncate">Cash Book and Statement</span>
            <i class="angle fe fe-chevron-right"></i>
        </a>
        <ul class="nav-sub">
            
            
            
                        
                            <li class="nav-item  ">
                    <a class="nav-link" href="https://sof.efmsmoeys.com/sof/sof_report" data-placement="right" side-menu-data-toggle="tooltip" title="" data-original-title="ReportAnnual Budget Plan">
                        <i class="bi bi-graph-up"></i>
                        <span class="sidemenu-label text-truncate">
                            ReportAnnual Budget Plan                        </span>
                    </a>
                </li>
                        
                            <li class="nav-item ">
                    <a class="nav-link" href="https://sof.efmsmoeys.com/sof_report" data-placement="right" side-menu-data-toggle="tooltip" title="" data-original-title="Cash Book and Financial Statement">
                        <i class="bi bi-graph-up"></i>
                        <span class="sidemenu-label text-truncate">Cash Book and Financial Statement</span>
                    </a>
                </li>
            
            
            
            
                    </ul>
    </li>
                                                    
            
            <li class="nav-item">
        <a class="nav-link with-sub" href="" data-placement="right" side-menu-data-toggle="tooltip" title="" data-original-title="About School">
            <i class="bi bi-info-circle"></i>
            <span class="sidemenu-label text-truncate">About School</span>
            <i class="angle fe fe-chevron-right"></i>
        </a>
        <ul class="nav-sub">
            <li class="nav-sub-item">
                </li><li class="nav-item ">
                    <a class="nav-link" href="https://sof.efmsmoeys.com/sof/add_info" data-placement="right" side-menu-data-toggle="tooltip" title="" data-original-title="School Information">
                        <i class="bi bi-building"></i>
                        <span class="sidemenu-label text-truncate">School Information</span>
                    </a>
                </li>
                                                            <li class="nav-item">
                            <a class="nav-link" href="https://sof.efmsmoeys.com/sof/statistic" data-placement="right" side-menu-data-toggle="tooltip" title="" data-original-title="School Statistic Quote">
                                <i class="bi bi-chat-text"></i>
                                <span class="sidemenu-label text-truncate">School Statistic Quote</span>
                            </a>
                        </li>
                                                
        </ul>
    </li>





            
            
            <li class="nav-item">
        <a class="nav-link" href="https://sof.efmsmoeys.com/feedback/index" data-placement="right" side-menu-data-toggle="tooltip" title="" data-original-title="FeedBack">
            <i class="bi bi-chat"></i>
            <span class="sidemenu-label text-truncate">FeedBack</span>
        </a>
    </li>
    
                    
            <li class="nav-item ">
                <a class="nav-link" href="https://sof.efmsmoeys.com/about/system" data-placement="right" side-menu-data-toggle="tooltip" title="" data-original-title="About System">
                    <i class="bi bi-info-circle"></i>
                    <span class="sidemenu-label text-truncate">About System</span>
                </a>
            </li>
            <li class="nav-item ">
                <a class="nav-link" href="https://sof.efmsmoeys.com/other/document" data-placement="right" side-menu-data-toggle="tooltip" title="" data-original-title="Website and Document">
                    <i class="bi bi-link"></i>
                    <span class="sidemenu-label text-truncate">Website and Document</span>
                </a>
            </li>
        </ul>
    </div>
<div class="ps__rail-x" style="left: 0px; top: 0px;"><div class="ps__thumb-x" tabindex="0" style="left: 0px; width: 0px;"></div></div><div class="ps__rail-y" style="top: 0px; height: 407px; right: 0px;"><div class="ps__thumb-y" tabindex="0" style="top: 0px; height: 252px;"></div></div></div>

<!-- End Sidemenu -->
<!-- Main Content-->
<div class="main-content side-content pt-0">
	<!-- Main Header-->
<div class="main-header side-header sticky sticky-pin" style="margin-bottom: -39px;">
	<div class="container-fluid">
		<div class="main-header-left">
			<a class="main-logo d-lg-none" href="https://sof.efmsmoeys.com/sof">
				<img src="https://sof.efmsmoeys.com/assets/img/brand/logo.png" class="header-brand-img desktop-logo" alt="logo">
				<img src="https://sof.efmsmoeys.com/assets/img/brand/logo.png" class="header-brand-img icon-logo" alt="logo">
				<img src="https://sof.efmsmoeys.com/assets/img/brand/logo.png" class="header-brand-img desktop-logo theme-logo" alt="logo">
				<img src="https://sof.efmsmoeys.com/assets/img/brand/logo.png" class="header-brand-img icon-logo theme-logo" alt="logo">
			</a>
			<a class="main-header-menu-icon" href="" id="mainSidebarToggle"><span></span></a>
		</div>
		<div class="main-header-right">
			<div class="dropdown d-md-flex">
				<a class="nav-link icon full-screen-link">
					<i class="fe fe-maximize fullscreen-button"></i>
				</a>
			</div>
			<div>
				<a href="https://sof.efmsmoeys.com/lang/en">English | </a>
				<a href="https://sof.efmsmoeys.com/lang/kh">ខ្មែរ</a>
			</div>
			
			<div class="dropdown main-profile-menu">

				<a class="main-img-user" href=""><img alt="avatar" src="https://sof.efmsmoeys.com/assets/img/users/1.png"></a>
				<div class="dropdown-menu">
					<div class="header-navheading">
						<h6 class="main-notification-title" style="line-height: 30px !important;">សាលាបឋមសិក្សា រោគ</h6>
						<p class="main-notification-text">User_School</p>
					</div>
					

					<hr class="m-0">
					<a id="setting-menu" style="cursor: pointer; user-select: none;" onclick="myFunction(); toggleClass();" class="dropdown-item">
						<i class="fe fe-settings"></i> Setting													<i style="margin-left: 100px; float: right;" class="chevron fe fe-chevron-right"></i>
											</a>
					<div id="myDropdown" class="dropdown-content dropdown radius" style="max-width: 212px !important; margin-top: -14px !important; margin-bottom: 18px !important;">
						<a class="dropdown-item" onclick="show_account_setting(`https://sof.efmsmoeys.com/account_setting`)" data-target="#profile" id="modal_1" data-toggle="modal" href="#setting/account">
							<i class="fe fe-user"></i> Account						</a>
						<a class="dropdown-item" onclick="showFiscalYearSetting(`https://sof.efmsmoeys.com/show_fiscal_year_setting`)" href="#setting/fiscal_year">
							<i class="fe fe-calendar"></i> Fiscal Year						</a>
																									<a class="dropdown-item" onclick="showSchoolLevelSetting(`https://sof.efmsmoeys.com/show_school_level_setting`)" href="#setting/school_level">
								<i class="fe fe-bar-chart"></i> School Level							</a>
											</div>

					<hr class="m-0">

					<a class="dropdown-item" href="https://sof.efmsmoeys.com/logout">
						<i class="fe fe-power"></i> Sign Out
					</a>
				</div>
			</div>
		</div>
	</div>
</div><div class="jumps-prevent" style="padding-top: 39px;"></div>
<!-- End Main Header-->

<div class="modal" id="setting_modal"></div>	<div class="container-fluid">
		    <div class="page-header row">
        <div class="col-12 col-sm-12 col-md-12 col-lg-12 col-xl-12" style="display:block;text-align:center;">
            <h2 class="tx-24 m-0">
                                    សាលាបឋមសិក្សា រោគ

                            </h2>
            <br>
                                                                    <br>
            <h2 class="tx-24 m-0">Fiscal Year 2025</h2>
        </div>
    </div>
                    <div class="row justify-content-center">
            <div class="col-md-8 col-sm-8">
                <div class="card custom-card">
                    <div class="card-body">
                        <div aria-multiselectable="true" class="accordion" id="accordion" role="tablist">
                            <div class="card">
                                <div class="card-header bg-primary freeze-header" id="headingOne">
                                    <a aria-expanded="true"><h6 class="text-left m-0">Information of School</h6></a>
                                </div>
                                <div aria-labelledby="headingOne" class="collapse show" data-parent="#accordion" id="collapseOne" role="tabpanel">
                                    <div class="card-body">
                                        <table class="table table-hover">
                                            <tbody>
                                                <tr>
                                                    <th class="text-left" width="30%" style="padding: 7px 15px;">Code</th>
                                                    <td class="text-center" width="1%" style="padding: 7px 15px;">:</td>
                                                    <td class="text-left" width="69%" style="padding: 7px 15px;">01030401017</td>
                                                </tr>
                                                <tr>
                                                    <th class="text-left" width="30%" style="padding: 7px 15px;">School Name</th>
                                                    <td class="text-center" width="1%" style="padding: 7px 15px;">:</td>
                                                    <td class="text-left" width="69%" style="padding: 7px 15px;">សាលាបឋមសិក្សា រោគ</td>
                                                </tr>
                                                <tr>
                                                    <th class="text-left" width="30%" style="padding: 7px 15px;">School Latin Name</th>
                                                    <td class="text-center" width="1%" style="padding: 7px 15px;">:</td>
                                                    <td class="text-left" width="69%" style="padding: 7px 15px;">Primary School : Rauk</td>
                                                </tr>
                                                <tr>
                                                    <th class="text-left" width="30%" style="padding: 7px 15px;">Province/City</th>
                                                    <td class="text-center" width="1%" style="padding: 7px 15px;">:</td>
                                                    <td class="text-left" width="69%" style="padding: 7px 15px;">01. ខេត្តបន្ទាយមានជ័យ</td>
                                                </tr>
                                                <tr>
                                                    <th class="text-left" width="30%" style="padding: 7px 15px;">Distric/Khan</th>
                                                    <td class="text-center" width="1%" style="padding: 7px 15px;">:</td>
                                                    <td class="text-left" width="69%" style="padding: 7px 15px;">0103. ស្រុកភ្នំស្រុក</td>
                                                </tr>
                                                <tr>
                                                    <th class="text-left" width="30%" style="padding: 7px 15px;">Commune/Sangkat</th>
                                                    <td class="text-center" width="1%" style="padding: 7px 15px;">:</td>
                                                    <td class="text-left" width="69%" style="padding: 7px 15px;">010304. ស្ពានស្រែង</td>
                                                </tr>
                                                
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <a href="https://sof.efmsmoeys.com/feedback/index?auto-open-modal=true">
  <div class="feedback-button">
      <i class="bi bi-chat-right-text-fill icon"></i>
    </div>
</a>
<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
  }
  .feedback-button {
    position: fixed;
    bottom: 30px;
    right: 30px;
    background-color: green;
    color: #fff;
    padding: 15px 18px;
    border-radius: 50px;
    cursor: pointer;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  }
</style>
		
</div>
</div>
		
		<!-- Main Footer-->
<div class="main-footer text-center">
	<div class="container">
		<div class="row">
			<div class="col-md-12 KhmerOSmuollight">
				<span>Prepared by: Department of Finance</span>
			</div>
		</div>
	</div>
</div>
<!--End Footer-->
	</div>

<!-- Back-to-top -->
<a href="#top" id="back-to-top"><i class="fe fe-arrow-up"></i></a>

<!-- Jquery js-->
<script src="https://sof.efmsmoeys.com/assets/plugins/jquery/jquery.min.js"></script>

<!-- Bootstrap js-->
<script src="https://sof.efmsmoeys.com/assets/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>

<!-- Ionicons js-->
<script src="https://sof.efmsmoeys.com/assets/plugins/ionicons/ionicons.js"></script>
<script src="https://sof.efmsmoeys.com/assets/js/waiting.js"></script>
<!-- Select2 js-->
<script src="https://sof.efmsmoeys.com/assets/plugins/select2/js/select2.min.js"></script>
<!-- izitoast -->
<script src="https://sof.efmsmoeys.com/izitoast/js/iziToast.min.js" type="text/javascript"></script>

<!-- Jquery-Ui js-->
<script src="https://sof.efmsmoeys.com/assets/plugins/jquery-ui/ui/widgets/datepicker.js"></script>

<!-- index -->

<!-- Chartjs charts js-->
<script src="https://sof.efmsmoeys.com/assets/plugins/chart.js/Chart.bundle.min.js"></script>


<script src="https://sof.efmsmoeys.com/assets/plugins/chartjsPluginLabel/chartjs-plugin-labels.js"></script>


<!-- Perfect-scrollbar js-->
<script src="https://sof.efmsmoeys.com/assets/plugins/perfect-scrollbar/perfect-scrollbar.min.js"></script>

<!-- Sidemenu js-->
<script src="https://sof.efmsmoeys.com/assets/plugins/sidemenu/sidemenu.js"></script>

<!-- Sidebar js-->
<script src="https://sof.efmsmoeys.com/assets/plugins/sidebar/sidebar.js"></script>

<!-- Sticky js-->
<script src="https://sof.efmsmoeys.com/assets/js/sticky.js"></script>
<!-- Custom js-->
<script src="https://sof.efmsmoeys.com/assets/js/custom.js"></script>

<script>
	// tooltip
	$("[side-menu-data-toggle=tooltip]").tooltip({
         trigger: 'hover',
     });
</script>

<script>
(function () {
  function enableBackReload() {
    // Reload if the page was restored from the bfcache (Back/Forward)
    window.addEventListener('pageshow', function (event) {
      // Modern, reliable check
      const nav = performance.getEntriesByType && performance.getEntriesByType('navigation')[0];
      const cameFromBFCache = event.persisted || (nav && nav.type === 'back_forward');

      if (cameFromBFCache) {
        // Hard reload to re-run all scripts and refetch data
        window.location.reload();
      }
    });

    // Safari quirk: ensure pageshow fires correctly after back/forward
    window.addEventListener('unload', function () {});
  }

  // expose globally so you can call it anywhere if needed
  window.App = window.App || {};
  window.App.enableBackReload = enableBackReload;

  // Auto-enable for all pages
  enableBackReload();
})();
</script>

<script>
	/* When the user clicks on the button,
            toggle between hiding and showing the dropdown content */
	function myFunction() {
		document.getElementById("myDropdown").classList.toggle("show");
	}

	// Close the dropdown if the user clicks outside of it
	window.onclick = function (event) {
		if (!event.target.matches('.dropbtn')) {
			var dropdowns = document.getElementsByClassName("dropdown-content");
			var i;
			for (i = 0; i < dropdowns.length; i++) {
				var openDropdown = dropdowns[i];
				if (openDropdown.classList.contains('show')) {
					openDropdown.classList.remove('show');
				}
			}
		}
	}

	// for use route in ajax
    var route = function (url, value) {
        let tmp_url = url;
        value.forEach((val) => {
            tmp_url = tmp_url.replace('-0', val);
        });
        return tmp_url;
    }
</script>

<script>
	//if pw match verify pw
	function IfMatchPw(pw,vpw) {
		$('.changed_pw').prop("disabled", true);
		$('.changed_pw').css("cursor", "not-allowed");

		var decimal= /^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[^a-zA-Z0-9])(?!.*\s).{8,15}$/;
		// let regex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/;
		
		pw = $(pw).val();
		vpw = $(vpw).val();
		old_pw = $('#old_pw').val();

		if(pw == vpw){
			$('.notverifypw').hide();
			if(pw.match(decimal))
			// if(regex.test(pw))
			{
				$('.pwstrength').hide();
			}
			else
			{
				$('.changed_pw').prop("disabled", true);
				$('.changed_pw').css("cursor", "not-allowed");

				$('.pwstrength').show();
			}
			if (old_pw!=null && old_pw!='' && pw.match(decimal)) {
				$('.changed_pw').prop("disabled", false);
				$('.changed_pw').css("cursor", "pointer");
			}
		}else{
			$('.changed_pw').prop("disabled", true);
			$('.changed_pw').css("cursor", "not-allowed");
			$('.notverifypw').show();
		}
	}
	//change password
	function SubmitChangePw(formPw){
		event.preventDefault();
		$.ajax({
			url: `https://sof.efmsmoeys.com/change_password`,
			type: 'POST',
			cache: false,
			dataType: "json",
			data: {
				"_token" : "bFuPrwGZILPqAozYW8PljycSmevJGhguauklDMeG",
				"password" : $('#old_pw').val(),
				"newPw" : $('#verify_new_pw').val()
			},
			beforeSend: function( xhr ) {
				waiting.waitingUI('block');
			},
			success: function (res) {
				$('#old_pw').val("");
				$('#verify_new_pw').val("");
				$('#verify_pw').val("");
				waiting.waitingUI('none');
				iziToast.success({
						title: "",
						titleSize: '18',
						timeout: 8000,
						message: "Data is successfully saved.",
						titlmessageSize: '14',
						position: 'topRight',
						progressBarColor: '#1100FF',
				});
			},
			error: function (xhr, textStatus, errorThrown) {
				$('#old_pw').val("");
				$('#verify_new_pw').val("");
				$('#verify_pw').val("");

				var returnBack = JSON.parse(xhr.responseText);
				switch (returnBack.code) {
						case 400:
							iziToast.error({
								//color:'#f55742',
								title: "",
								titleSize: '18',
								//titleColor: '',
								timeout: 8000,
								message: returnBack.message?returnBack.message:returnBack.error,
								titlmessageSize: '14',
								//messageColor: '',
								maxWidth: 700,
								position: 'topRight',
								progressBarColor: '#fa0505',
							});
							waiting.waitingUI('none');
						break;
						default:
							iziToast.error({
								//color:'#f55742',
								title: "Error",
								titleSize: '18',
								//titleColor: '',
								timeout: 8000,
								message: returnBack.message?returnBack.message:returnBack.error,
								titlmessageSize: '14',
								//messageColor: '',
								maxWidth: 700,
								position: 'topRight',
								progressBarColor: '#fa0505',
							});
							waiting.waitingUI('none');
				}
			}
		});
	}
	//change Display Name
	function SubmitChangeInfo(){
		event.preventDefault();
		$.ajax({
			url: `https://sof.efmsmoeys.com/change_info`,
			type: 'POST',
			cache: false,
			dataType: "json",
			data: {
				"_token" : "bFuPrwGZILPqAozYW8PljycSmevJGhguauklDMeG",
				"display_name" : $('#dp_name').val(),
				// "distance_doe" : $('#km_distance').val(),
			},
			beforeSend: function( xhr ) {
				waiting.waitingUI('block');
			},
			success: function (res) {
				$(".main-notification-title").html($('#dp_name').val());
				waiting.waitingUI('none');
				iziToast.success({
						title: "",
						titleSize: '18',
						timeout: 8000,
						message: "Data is successfully saved.",
						titlmessageSize: '14',
						position: 'topRight',
						progressBarColor: '#1100FF',
				});
			},
			error: function (xhr, textStatus, errorThrown) {
				var returnBack = JSON.parse(xhr.responseText);
				switch (returnBack.code) {
						case 400:
							iziToast.error({
								//color:'#f55742',
								title: "",
								titleSize: '18',
								//titleColor: '',
								timeout: 8000,
								message: returnBack.message?returnBack.message:returnBack.error,
								titlmessageSize: '14',
								//messageColor: '',
								maxWidth: 700,
								position: 'topRight',
								progressBarColor: '#fa0505',
							});
							waiting.waitingUI('none');
						break;
						default:
							iziToast.error({
								//color:'#f55742',
								title: "Error",
								titleSize: '18',
								//titleColor: '',
								timeout: 8000,
								message: returnBack.message?returnBack.message:returnBack.error,
								titlmessageSize: '14',
								//messageColor: '',
								maxWidth: 700,
								position: 'topRight',
								progressBarColor: '#fa0505',
							});
							waiting.waitingUI('none');
				}
			}
		});
	}
	// validate password strength
	function CheckPassword(pw,vpw)
	{
		pw = $(pw).val();
		vpw = $(vpw).val();
		$('.changed_pw').prop("disabled", false);
		$('.changed_pw').css("cursor", "not-allowed");

		old_pw = $('#old_pw').val();

		// var decimal= /^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[^a-zA-Z0-9])(?!.*\s).{8,15}$/;
		let regex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/;
        // let password = pw.verify_pw;
        // let result = regex.test(password);

		$('.changed_pw').prop("disabled", true);
		$('.changed_pw').css("cursor", "not-allowed");

		// if()regex.test(pw)
		if(pw.match(decimal))
		{
			$('.pwstrength').hide();
			if(pw == vpw){
				$('.notverifypw').hide();
			}
			else
			{
				$('.changed_pw').prop("disabled", true);
				$('.changed_pw').css("cursor", "not-allowed");

				$('.notverifypw').show();
			}
			if (old_pw!=null && old_pw!='' && pw.match(decimal)) {
				if(pw == vpw){
					$('.changed_pw').prop("disabled", false);
					$('.changed_pw').css("cursor", "pointer");
				}
			}
		}
		else
		{
			$('.changed_pw').prop("disabled", true);
			$('.changed_pw').css("cursor", "not-allowed");

			$('.pwstrength').show();
		}
	}
	
	function showPassword(icon,input) {
		var psw = document.getElementById(input);
		if (psw.type === "password"){
			psw.type = "text";
			$(icon).removeClass("bi-eye-slash");
			$(icon).addClass("bi-eye");
		} else {
			psw.type = "password";
			$(icon).removeClass("bi-eye");
			$(icon).addClass("bi-eye-slash");
			// $(icon).toggle("bi-eye");
		}
	}

	function showFiscalYearSetting(route){
	   // alert(route);
	   $.ajaxSetup({
		   headers: {
			   'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
		   }
	   });
	   $.ajax({
		   type: "get",
		   url: route,
		   dataType: 'json',
		   beforeSend: function (xhr) {
			   waiting.waitingUI('block');
		   },
		   success: function (result) {
			  $("#setting_modal").html(result.result);
			  $("#setting_modal").modal('toggle');
			  waiting.waitingUI('none');
		   },
		   error: function (xhr) {
			   let result = JSON.parse(xhr.responseText);
			   switch (result.code) {
				   case 400:
					   let validate = "";
					   let i = 1;
					   for (const elem in result.errors) {
						   validate += `<br>${i}: ${elem}<br>`;
						   i++;
					   }
					   iziToast.error({
						   title: result.code,
						   titleSize: '18',
						   timeout: 8000,
						   message: result.message?result.message:result.error,
						   titlmessageSize: '14',
						   maxWidth: 700,
						   position: 'topRight',
						   progressBarColor: '#fa0505',
					   });
					   waiting.waitingUI('none');
					   break;
				   default:
					   iziToast.error({
						   title: result.code,
						   titleSize: '18',
						   timeout: 8000,
						   message: result.message?result.message:result.error,
						   titlmessageSize: '14',
						   maxWidth: 700,
						   position: 'topRight',
						   progressBarColor: '#fa0505',
					   });
					   waiting.waitingUI('none');
			   }
		   }
	   });
	   return false;
	}

	function show_account_setting(route){
	   // alert(route);
	   $.ajaxSetup({
		   headers: {
			   'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
		   }
	   });
	   $.ajax({
		   type: "get",
		   url: route,
		   dataType: 'json',
		   beforeSend: function (xhr) {
			   waiting.waitingUI('block');
		   },
		   success: function (result) {
			  $("#setting_modal").html(result.result);
			  $("#setting_modal").modal('toggle');
			  waiting.waitingUI('none');
		   },
		   error: function (xhr) {
			   let result = JSON.parse(xhr.responseText);
			   switch (result.code) {
				   case 400:
					   let validate = "";
					   let i = 1;
					   for (const elem in result.errors) {
						   validate += `<br>${i}: ${elem}<br>`;
						   i++;
					   }
					   iziToast.error({
						   title: result.code,
						   titleSize: '18',
						   timeout: 8000,
						   message: result.message?result.message:result.error,
						   titlmessageSize: '14',
						   maxWidth: 700,
						   position: 'topRight',
						   progressBarColor: '#fa0505',
					   });
					   waiting.waitingUI('none');
					   break;
				   default:
					   iziToast.error({

						   title: result.code,
						   titleSize: '18',
						   timeout: 8000,
						   message: result.message?result.message:result.error,
						   titlmessageSize: '14',
						   maxWidth: 700,
						   position: 'topRight',
						   progressBarColor: '#fa0505',
					   });
					   waiting.waitingUI('none');
			   }
		   }
	   });
	   return false;
	}

	function show_mng_account_setting(route){
	   // alert(route);
	   $.ajaxSetup({
		   headers: {
			   'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
		   }
	   });
	   $.ajax({
		   type: "get",
		   url: route,
		   dataType: 'json',
		   beforeSend: function (xhr) {
			   waiting.waitingUI('block');
		   },
		   success: function (result) {
			  $("#setting_modal").html(result.result);
			  $("#setting_modal").modal('toggle');
			  waiting.waitingUI('none');
		   },
		   error: function (xhr) {
			   let result = JSON.parse(xhr.responseText);
			   switch (result.code) {
				   case 400:
					   let validate = "";
					   let i = 1;
					   for (const elem in result.errors) {
						   validate += `<br>${i}: ${elem}<br>`;
						   i++;
					   }
					   iziToast.error({
						   title: result.code,
						   titleSize: '18',
						   timeout: 8000,
						   message: result.message,
						   titlmessageSize: '14',
						   maxWidth: 700,
						   position: 'topRight',
						   progressBarColor: '#fa0505',
					   });
					   waiting.waitingUI('none');
					   break;
				   default:
					   iziToast.error({

						   title: result.code,
						   titleSize: '18',
						   timeout: 8000,
						   message: result.message,
						   titlmessageSize: '14',
						   maxWidth: 700,
						   position: 'topRight',
						   progressBarColor: '#fa0505',
					   });
					   waiting.waitingUI('none');
			   }
		   }
	   });
	   return false;
	}

	let frmFiscalYear = {
	   submit: function (formId,postTo) {
		   let xhr = new XMLHttpRequest();
		   let formData = new FormData(document.getElementById(`${formId}`));
		   xhr.open('post', `${postTo}`, true);
		   waiting.waitingUI('block');
		   xhr.onload = function () {
			   let result =JSON.parse(xhr.response);
			   switch (xhr.status) {
				   case 200:
					   $('#setting_modal').modal('toggle');
					   waiting.waitingUI('none');
					   iziToast.success({
							   title: "",
							   titleSize: '18',
							   timeout: 8000,
							   message: "Data is successfully saved.",
							   titlmessageSize: '14',
							   position: 'topRight',
							   progressBarColor: '#1100FF',
						   });
						   window.location.reload();
					   break;
				   case 400:
					   let validate = "";
					   let i = 1;
					   for (const elem of Object.entries(result.errors)) {
						   validate += `<br>${i}: ${elem[1]}<br>`;
						   i++;
					   }
					   iziToast.error({
						   title: '',
						   titleSize: '18',
						   timeout: 8000,
						   message: validate,
						   titlmessageSize: '14',
						   maxWidth: 700,
						   position: 'topRight',
						   progressBarColor: '#fa0505',
					   });
					   let validate_msg = Object.keys(result.errors);
					   validateShow(validate_msg,formData);
					   waiting.waitingUI('none');
					   break;
				   default:
					   iziToast.error({
						   title: '',
						   titleSize: '18',
						   timeout: 8000,
						   message: result.message?result.message:result.error,
						   titlmessageSize: '14',
						   maxWidth: 700,
						   position: 'topRight',
						   progressBarColor: '#fa0505',
					   });
					   waiting.waitingUI('none');
			   }
		   };
		   xhr.send(formData);
	   }
	}
	function toggleClass(){
        $("#setting-menu .chevron").toggleClass("fe-chevron-down fe-chevron-right");
	}
	$('.main-img-user').click(function(e){
		if ($('#myDropdown').hasClass('show'))
		{
			$('.chevron').removeClass('fe-chevron-right');
			$('.chevron').addClass('fe-chevron-down');
		} else
		{
			$('.chevron').removeClass('fe-chevron-down');
			$('.chevron').addClass('fe-chevron-right');
		}
	});
	$('.main-img-user, #setting-menu').click(function(e){
	  	if ($('#myDropdown').height() > '190')
		{
			$('#myDropdown').css({"overflow-y": "scroll", "max-height": "190px"});
		}
	});
	//for number format onkeypress with decimal number
	function dotNumber(evt, main)
	{
		var value = $(main).val() + "";
		var status = false;
		evt = (evt) ? evt : window.event;
		var charCode = (evt.which) ? evt.which : evt.keyCode;
		if (charCode == 46) {
			status = false;
			for (var i = 0; i < value.length; i++)
			{
				if (status == true) {
					value[i] = '';
					$(main).val(value);
				}
				if (value[i] == '.') {
					status = true;
				}
			}
			if (status == true) {
				return false;
			}
			for (var i = 0; i < value.length; i++)
			{
				if (value[i] == '.' && i > 0 && status == false) {
					status = true;
				}
			}
		}
		else if (charCode > 31 && (charCode < 48 || charCode > 57)) {
			return false;
		}
		return true;
	}
	
</script>

<script>
	function showSchoolLevelSetting(route){
	   // alert(route);
	   $.ajaxSetup({
		   headers: {
			   'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
		   }
	   });
	   $.ajax({
		   type: "get",
		   url: route,
		   dataType: 'json',
		   beforeSend: function (xhr) {
			   waiting.waitingUI('block');
		   },
		   success: function (result) {
			  $("#setting_modal").html(result.result);
			  $("#setting_modal").modal('toggle');
			  waiting.waitingUI('none');
		   },
		   error: function (xhr) {
			   let result = JSON.parse(xhr.responseText);
			   switch (result.code) {
				   case 400:
					   let validate = "";
					   let i = 1;
					   for (const elem in result.errors) {
						   validate += `<br>${i}: ${elem}<br>`;
						   i++;
					   }
					   iziToast.error({
						   title: result.code,
						   titleSize: '18',
						   timeout: 8000,
						   message: result.message?result.message:result.error,
						   titlmessageSize: '14',
						   maxWidth: 700,
						   position: 'topRight',
						   progressBarColor: '#fa0505',
					   });
					   waiting.waitingUI('none');
					   break;
				   default:
					   iziToast.error({

						   title: result.code,
						   titleSize: '18',
						   timeout: 8000,
						   message: result.message?result.message:result.error,
						   titlmessageSize: '14',
						   maxWidth: 700,
						   position: 'topRight',
						   progressBarColor: '#fa0505',
					   });
					   waiting.waitingUI('none');
			   }
		   }
	   });
	   return false;
	}

	let frmSchoolLevel = {
	   submit: function (formId,postTo) {
		   let xhr = new XMLHttpRequest();
		   let formData = new FormData(document.getElementById(`${formId}`));
		   xhr.open('post', `${postTo}`, true);
		   waiting.waitingUI('block');
		   xhr.onload = function () {
			   let result =JSON.parse(xhr.response);
			   switch (xhr.status) {
				   case 200:
					   $('#setting_modal').modal('toggle');
					   waiting.waitingUI('none');
					   iziToast.success({
							   title: "",
							   titleSize: '18',
							   timeout: 8000,
							   message: "Data is successfully saved.",
							   titlmessageSize: '14',
							   position: 'topRight',
							   progressBarColor: '#1100FF',
						   });
						   window.location.reload();
					   break;
				   case 400:
					   let validate = "";
					   let i = 1;
					   for (const elem of Object.entries(result.errors)) {
						   validate += `<br>${i}: ${elem[1]}<br>`;
						   i++;
					   }
					   iziToast.error({
						   title: '',
						   titleSize: '18',
						   timeout: 8000,
						   message: validate,
						   titlmessageSize: '14',
						   maxWidth: 700,
						   position: 'topRight',
						   progressBarColor: '#fa0505',
					   });
					   let validate_msg = Object.keys(result.errors);
					   validateShow(validate_msg,formData);
					   waiting.waitingUI('none');
					   break;
				   default:
					   iziToast.error({
						   title: '',
						   titleSize: '18',
						   timeout: 8000,
						   message: result.message?result.message:result.error,
						   titlmessageSize: '14',
						   maxWidth: 700,
						   position: 'topRight',
						   progressBarColor: '#fa0505',
					   });
					   waiting.waitingUI('none');
			   }
		   };
		   xhr.send(formData);
	   }
	}
</script>
<script>
    function createUploadInventory(route){
        $.ajaxSetup({
            headers: {
                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
            }
        });
        $.ajax({
            type: "get",
            url: route,
            dataType: 'json',
            beforeSend: function (xhr) {
                waiting.waitingUI('block');
            },
            success: function (result) {
                $("#view_modal").html(result.modal);
                $("#view_modal").modal('toggle');
                waiting.waitingUI('none');
            },
            error: function (xhr) {
                let result = JSON.parse(xhr.responseText);
                switch (result.code) {
                    case 400:
                        let validate = "";
                        let i = 1;
                        for (const elem in result.errors) {
                            validate += `<br>${i}: ${elem}<br>`;
                            i++;
                        }
                        iziToast.error({
                            title: result.code,
                            titleSize: '18',
                            timeout: 8000,
                            message: result.validate,
                            titlmessageSize: '14',
                            maxWidth: 700,
                            position: 'topRight',
                            progressBarColor: '#fa0505',
                        });
                        waiting.waitingUI('none');
                        break;
                    default:
                        iziToast.error({

                            title: result.code,
                            titleSize: '18',
                            timeout: 8000,
                            message: result.validate,
                            titlmessageSize: '14',
                            maxWidth: 700,
                            position: 'topRight',
                            progressBarColor: '#fa0505',
                        });
                        waiting.waitingUI('none');
                }
            }
        });
        return false;
    }
    async function readExcelInventory() {
        try {
            $('#btn_submit_inventory').attr("disabled", true);
            waiting.waitingUI('block');
            var input = event.target;
            let contentBuffer = await readFileAsyncInventory(input.files[0]);
            $('#quarter').attr("disabled", true);
            $("#btn_submit_inventory").removeAttr("disabled");
            waiting.waitingUI('none');

        } catch(err) {
            $("#btn_submit_inventory").attr("disabled", true);
            iziToast.error({
                title: 'ការទាញយកមិនបានជោគជ័យ!',
                titleSize: '18',
                timeout: 8000,
                message: 'មិនអាចទាញយកទិន្នន័យពីប្រព័ន្ធ Excel ដែលបានជ្រើសរើស។ សូមប្រាកដថា File ដែលលោកអ្នកបានជ្រើសរើសគឺជាប្រព័ន្ធកិច្ចបញ្ចិការគណនេយ្យសម្ភារៈ Excel .xlsb។ សូមអរគុណ!',
                titlmessageSize: '14',
                maxWidth: 700,
                position: 'topRight',
                progressBarColor: '#fa0505',
            });
            $('#p0').html('');
            $('#p1').html('');
            // $('#p5').html('');
        } finally {
            waiting.waitingUI('none');
        }
    }
    function readFileAsyncInventory(file){
        try{
            return new Promise((resolve, reject) => {
                let reader = new FileReader();
                reader.onload = () => {
                    resolve(test(reader.result));
                };
                async function test(result) {
                    var fileData = result;
                    var wb = XLSX.read(fileData, {type : 'binary'});
                    let sheet_info = wb.Sheets['Master_data'];
                    let fiscal_year = sheet_info.A7.v;
                    $('#school_code_excel').val(sheet_info.B28.v);
                    $('#fiscal_year_excel').val(sheet_info.A7.v);
                    $('#school_level_excel').val(sheet_info.B27.v);
                    let stock_in=wb.Sheets['ប្រតិបត្តិការបញ្ចូល'];
                    for (let [key] of Object.entries(stock_in)){
                        if (stock_in[key]){
                            if(key.includes('!')){
                                delete stock_in[key];
                            }else if(key.includes('A')){
                                delete stock_in[key];
                            }else if(key.includes('K') || key.includes('N') || key.includes('O')){
                                for (const [sub_key] of Object.entries(stock_in[key])) {
                                    if (sub_key != 'w'){
                                        delete stock_in[key][sub_key]
                                    }
                                }
                            }else{
                                if (stock_in[key]['v'] == 0){
                                    delete stock_in[key]
                                }else{
                                    for (const [sub_key] of Object.entries(stock_in[key])) {
                                        if (sub_key != 'v'){
                                            delete stock_in[key][sub_key]
                                        }
                                    }
                                }
                            }
                        }
                    }
                    let stock_out = wb.Sheets['ប្រតិបត្តិការបញ្ចេញ'];
                    for (let [key] of Object.entries(stock_out)){
                        if(key.includes('!')){
                            delete stock_out[key];
                        }else if(key.includes('A')){
                            delete stock_out[key];
                        }else if(key.includes('K')){
                            for (const [sub_key] of Object.entries(stock_out[key])) {
                                if (sub_key != 'w'){
                                    delete stock_out[key][sub_key]
                                }
                            }
                        }else{
                            for (const [sub_key] of Object.entries(stock_out[key])) {
                                if (sub_key != 'v'){
                                    delete stock_out[key][sub_key]
                                }
                            }
                        }
                    }
                    let quarter = $("#quarter").val();
                    await renderAllInventory(
                        stock_in,
                        stock_out,
                        fiscal_year,
                        quarter
                    );
                }
                reader.onerror = reject;
                reader.readAsBinaryString(file);
            });
        } catch (error) {
            throw error;
        }
    }
    async function renderAllInventory(stock_in, stock_out, fiscal_year,quarter) {
        // console.log(quarter);
        var myroute = `https://sof.efmsmoeys.com/inventory/upload_inventory/read_all`;
        $.ajaxSetup({
            headers: {
                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
            }
        });
        let data = {
                fiscal_year: fiscal_year,
                stock_in: stock_in,
                stock_out: stock_out,
                quarter:quarter
            }
        await $.ajax({
            type: "post",
            url: myroute,
            data: data,
            dataType: 'json',
            beforeSend: function (xhr) {
                // waiting.waitingUI('block');
            },
            success: function (result) {
                $('#p0').html(result.all_sheet.stock_in);
                $('#p1').html(result.all_sheet.stock_out);
                waiting.waitingUI('none');
            },
            error: function (xhr) {
                let result = JSON.parse(xhr.responseText);
                switch (result.code) {
                    case 400:
                        iziToast.error({
                            title: result.code,
                            titleSize: '18',
                            timeout: 8000,
                            message: result.message,
                            titlmessageSize: '14',
                            maxWidth: 700,
                            position: 'topRight',
                            progressBarColor: '#fa0505',
                        });
                        waiting.waitingUI('none');
                        break;
                    default:
                        iziToast.error({
                            title: result.code,
                            titleSize: '18',
                            timeout: 8000,
                            message: result.message,
                            titlmessageSize: '14',
                            maxWidth: 700,
                            position: 'topRight',
                            progressBarColor: '#fa0505',
                        });
                        waiting.waitingUI('none');
                }
            }
        });
        return true;
    }
    function storeInventory(formId,postTo){
        let quarter = $("#quarter").val();
        let formData = $("#"+formId).serialize();
        formData += `&quarter=${encodeURIComponent(quarter)}`;
        $.ajaxSetup({
            headers: {
                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
            }
        });
        $.ajax({
            type: "post",
            url: postTo,
            dataType: 'json',
            data: formData,
            beforeSend: function (xhr) {
                waiting.waitingUI('block');
            },
            success: function (result) {
                // $('#view_modal').modal('toggle');
                iziToast.success({
                    title: "",
                    titleSize: '18',
                    timeout: 8000,
                    message: "Data is successfully saved.",
                    titlmessageSize: '14',
                    position: 'topRight',
                    progressBarColor: '#1100FF',
                });
                $("#quarter").removeAttr("disabled");
                $('#p0').html('');
                $('#p1').html('');
                $('#btn_submit_inventory').attr("disabled", true);
                $('#excel_file').val('');
                waiting.waitingUI('none');
            },
            error: function (xhr) {
                let result =JSON.parse(xhr.responseText);
                switch (xhr.status) {
                    case 400:
                        let validate = "";
                        let i = 1;
                        for (const elem of Object.entries(result.errors)) {
                            validate += `<br>${i}: ${elem[1]}<br>`;
                            i++;
                        }
                        iziToast.error({
                            title: '',
                            titleSize: '18',
                            timeout: 8000,
                            message: validate,
                            titlmessageSize: '14',
                            maxWidth: 700,
                            position: 'topRight',
                            progressBarColor: '#fa0505',
                        });
                        let validate_msg = Object.keys(result.errors);
                        validateShow(validate_msg,formData);
                        break;
                    default:
                        iziToast.error({
                            title: '',
                            titleSize: '18',
                            timeout: 8000,
                            message: result.message,
                            titlmessageSize: '14',
                            maxWidth: 700,
                            position: 'topRight',
                            progressBarColor: '#fa0505',
                        });
                }
                waiting.waitingUI('none');
            }
        });
        return false;
    }
    function checkQuarter(){
        $('#excel_file').removeAttr("disabled");
    }
</script><script>
    function createUploadReport(route){
        $.ajaxSetup({
            headers: {
                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
            }
        });
        $.ajax({
            type: "get",
            url: route,
            dataType: 'json',
            beforeSend: function (xhr) {
                waiting.waitingUI('block');
            },
            success: function (result) {
                $("#view_modal").html(result.modal);
                $("#view_modal").modal('toggle');
                waiting.waitingUI('none');
            },
            error: function (xhr) {
                let result = JSON.parse(xhr.responseText);
                switch (result.code) {
                    case 400:
                        let validate = "";
                        let i = 1;
                        for (const elem in result.errors) {
                            validate += `<br>${i}: ${elem}<br>`;
                            i++;
                        }
                        iziToast.error({
                            title: result.code,
                            titleSize: '18',
                            timeout: 8000,
                            message: result.validate,
                            titlmessageSize: '14',
                            maxWidth: 700,
                            position: 'topRight',
                            progressBarColor: '#fa0505',
                        });
                        waiting.waitingUI('none');
                        break;
                    default:
                        iziToast.error({

                            title: result.code,
                            titleSize: '18',
                            timeout: 8000,
                            message: result.validate,
                            titlmessageSize: '14',
                            maxWidth: 700,
                            position: 'topRight',
                            progressBarColor: '#fa0505',
                        });
                        waiting.waitingUI('none');
                }
            }
        });
        return false;
    }
    
    async function readExcelReportUpload() {
        try {
            waiting.waitingUI('block');
            $('#btn_submit_report').attr("disabled", true);
            var input = event.target;
            let contentBuffer = await readFileAsyncReportUpload(input.files[0]);
            $("#btn_submit_report").removeAttr("disabled");
            $('#quarter').attr("disabled", true);
            waiting.waitingUI('none');
        } catch(err) {
            $("#btn_submit_report").attr("disabled", true);
            $("#excel_file").attr("disabled", false);
            iziToast.error({
                title: 'ការទាញយកមិនបានជោគជ័យ!',
                titleSize: '18',
                timeout: 8000,
                message: 'មិនអាចទាញយកប្រតិបត្តិការនៃរបាយការណ៍ពីប្រព័ន្ធ Excel ដែលបានជ្រើសរើស។ សូមប្រាកដថា File ដែលលោកអ្នកបានជ្រើសរើសគឺជាប្រព័ន្ធរបាយការណ៍ Excel .xlsb ដែលមានជំនាន់ចាប់ពី V 8.2 ឡើងទៅ។ សូមអរគុណ!',
                titlmessageSize: '14',
                maxWidth: 700,
                position: 'topRight',
                progressBarColor: '#fa0505',
            });
            $('#p0').html('');
            $('#p1').html('');
            $('#p2').html('');
            $('#p3').html('');
            $('#p4').html('');
            // $('#p5').html('');
        } finally {
            waiting.waitingUI('none');
        }
    }
    function readFileAsyncReportUpload(file){
        try{
            return new Promise((resolve, reject) => {
                let reader = new FileReader();
                reader.onload = () => {
                    resolve(test(reader.result));
                };
                async function test(result) {
                    var fileData = result;
                    var wb = XLSX.read(fileData, {type : 'binary'});
                    // check version
                    let sheet_info = wb.Sheets['ព័ត៌មាន'];
                    let version = sheet_info['E19']['v'].split(' ')[1];
                    // acept version V 8.2 and above
                    if (parseFloat(version)<8.2){
                        throw "This version does not support"
                    }
                    sheet_info = wb.Sheets['master_data'];
                    $('#school_code_excel').val(sheet_info.B43.v);
                    // $('#qter').val(sheet_info.P3.v);
                    $('#fiscal_year_excel').val(sheet_info.L2.v);
                    $('#school_level_excel').val(sheet_info.D59.v!=''?sheet_info.D59.v:(sheet_info.D58.v!=''?sheet_info.D58.v:''));
                    let AnnualBudget=wb.Sheets['ថ.ប្រចាំឆ្នាំ'];
                    for (let [key] of Object.entries(AnnualBudget)){
                        if (AnnualBudget[key]){
                            if(key.includes('!')){
                                delete AnnualBudget[key];
                            }else if (key.includes('AA')){
                                let num = parseInt(key.split('AA')[1]);
                                if (num>13){
                                    if (AnnualBudget[key]['v'] == 0){
                                        delete AnnualBudget[key];
                                        AnnualBudget['W'+num]? delete AnnualBudget['W'+num]:'';
                                        AnnualBudget['X'+num]? delete AnnualBudget['X'+num]:'';
                                        AnnualBudget['Y'+num]? delete AnnualBudget['Y'+num]:'';
                                        AnnualBudget['Z'+num]? delete AnnualBudget['Z'+num]:'';
                                    }else{
                                        for (const [sub_key] of Object.entries(AnnualBudget[key])) {
                                            if (sub_key != 'v'){
                                                delete AnnualBudget[key][sub_key]
                                            }
                                        }
                                    }
                                }else{
                                    for (const [sub_key] of Object.entries(AnnualBudget[key])) {
                                        if (sub_key != 'v'){
                                            delete AnnualBudget[key][sub_key]
                                        }
                                    }
                                }
                            }else if (key.includes('AB')){
                                let num = parseInt(key.split('AB')[1]);
                                if (num>13){
                                    if (AnnualBudget[key]['v'] == 0){
                                        delete AnnualBudget[key];
                                        AnnualBudget['AE'+num]? delete AnnualBudget['AE'+num]:'';
                                        AnnualBudget['AG'+num]? delete AnnualBudget['AG'+num]:'';
                                        AnnualBudget['AH'+num]? delete AnnualBudget['AH'+num]:'';
                                        AnnualBudget['AH'+num]? delete AnnualBudget['AH'+num]:'';
                                        AnnualBudget['B'+num]? delete AnnualBudget['B'+num]:'';
                                        AnnualBudget['C'+num]? delete AnnualBudget['C'+num]:'';
                                    }else{
                                        for (const [sub_key] of Object.entries(AnnualBudget[key])) {
                                            if (sub_key != 'v'){
                                                delete AnnualBudget[key][sub_key]
                                            }
                                        }
                                    }
                                }else{
                                    for (const [sub_key] of Object.entries(AnnualBudget[key])) {
                                        if (sub_key != 'v'){
                                            delete AnnualBudget[key][sub_key]
                                        }
                                    }
                                }
                            }else if (key.includes('AC') ||  key.includes('AD')){
                                delete AnnualBudget[key]
                            }else if (
                                key.includes('D9') ||
                                key.includes('L9') ||
                                key.includes('F12') ||
                                key.includes('K12') ||
                                key.includes('N12') ||
                                key.includes('S12') ||
                                key.includes('T9')
                            ){
                                for (const [sub_key] of Object.entries(AnnualBudget[key])) {
                                    if (sub_key != 'v'){
                                        delete AnnualBudget[key][sub_key]
                                    }
                                }
                            }else{
                                if (AnnualBudget[key]['v'] == 0){
                                    delete AnnualBudget[key]
                                }else{
                                    for (const [sub_key] of Object.entries(AnnualBudget[key])) {
                                        if (sub_key != 'v'){
                                            delete AnnualBudget[key][sub_key]
                                        }
                                    }
                                }
                            }
                        }
                    }
                    let Roth = wb.Sheets['រដ្ឋ'];
                    for (let [key] of Object.entries(Roth)){
                        if(key.includes('!')){
                            delete Roth[key];
                        }else{
                            for (const [sub_key] of Object.entries(Roth[key])) {
                                if (sub_key !== 'v'){
                                    delete Roth[key][sub_key]
                                }
                            }
                        }
                    }
                    let Bank = wb.Sheets['ធនាគារ'];
                    for (let [key] of Object.entries(Bank)){
                        if(Bank[key]){
                            if(key.includes('!')){
                                delete Bank[key];
                            }else if(key.includes('A')){
                                let num = parseInt(key.split('A')[1]);
                                if (num>10){
                                    delete Bank[key]
                                }else{
                                    for (const [sub_key] of Object.entries(Bank[key])) {
                                        if (sub_key != 'v'){
                                            delete Bank[key][sub_key]
                                        }
                                    }
                                }
                            }else if(key.includes('F')){
                                for (const [sub_key] of Object.entries(Bank[key])) {
                                    if (sub_key != 'w'){
                                        delete Bank[key][sub_key]
                                    }
                                }
                            }else{
                                if (Bank[key]['v'] == 0 || Bank[key]['v'] == ''){
                                    delete Bank[key]
                                }else{
                                    for (const [sub_key] of Object.entries(Bank[key])) {
                                        if (sub_key != 'v'){
                                            delete Bank[key][sub_key]
                                        }
                                    }
                                }
                            }
                        }
                    }
                    let Receipt = wb.Sheets['ចំណូល'];
                    for (let [key] of Object.entries(Receipt)){
                        if(key.includes('!')){
                            delete Receipt[key];
                        }else if(
                            key.includes('AB') ||
                            key.includes('N') ||
                            key.includes('O') ||
                            key.includes('P') ||
                            key.includes('Q') ||
                            key.includes('R') ||
                            key.includes('S') ||
                            key.includes('T') ||
                            key.includes('U') ||
                            key.includes('V') ||
                            key.includes('W')
                        ){
                            delete Receipt[key];
                        }else if(key.includes('AC') && Receipt[key]['v']==''){
                            delete Receipt[key];
                        }else if(key.includes('A')){
                            let num = parseInt(key.split('A')[1]);
                            if (num>10){
                                delete Receipt[key];
                            }else{
                                for (const [sub_key] of Object.entries(Receipt[key])) {
                                    if (sub_key != 'v'){
                                        delete Receipt[key][sub_key];
                                    }
                                }
                            }
                        }else if(key.includes('E')){
                            for (const [sub_key] of Object.entries(Receipt[key])) {
                                if (sub_key != 'w'){
                                    delete Receipt[key][sub_key];
                                }
                            }
                        }else{
                            for (const [sub_key] of Object.entries(Receipt[key])) {
                                if (sub_key != 'v'){
                                    delete Receipt[key][sub_key];
                                }
                            }
                        }
                    }
                    let Disbursement = wb.Sheets['ចំណាយ'];
                    for (let [key] of Object.entries(Disbursement)){
                        if(key.includes('!')){
                            delete Disbursement[key];
                        }else if(key.includes('AV')){
                            let num = parseInt(key.split('AV')[1]);
                            if (num<11){
                                delete Disbursement[key]
                            }else{
                                for (const [sub_key] of Object.entries(Disbursement[key])) {
                                    if (sub_key != 'v'){
                                        delete Disbursement[key][sub_key]
                                    }
                                }
                            }
                        }else if(
                            key.includes('T') ||
                            key.includes('U') ||
                            key.includes('V') ||
                            key.includes('W') ||
                            key.includes('X') ||
                            key.includes('Y') ||
                            key.includes('Z') ||
                            key.includes('AA') ||
                            key.includes('AB') ||
                            key.includes('AC') ||
                            key.includes('AD') ||
                            key.includes('AE') ||
                            key.includes('AF') ||
                            key.includes('AG') ||
                            key.includes('AH') ||
                            key.includes('AI') ||
                            key.includes('AJ') ||
                            key.includes('AL') ||
                            key.includes('AM') ||
                            key.includes('AN') ||
                            key.includes('AO') ||
                            key.includes('AP') ||
                            key.includes('AQ') ||
                            key.includes('AR') ||
                            key.includes('AS') ||
                            key.includes('AT') ||
                            key.includes('AU') ||
                            key.includes('AW') ||
                            key.includes('AX') ||
                            key.includes('AY') ||
                            key.includes('BD')
                        ){
                            delete Disbursement[key];
                        }else if(key.includes('BE') && Disbursement[key]['v']==''){
                            delete Disbursement[key];
                        }else if(key.includes('BG') && Disbursement[key]['v']==''){
                            delete Disbursement[key];
                        }else if(key.includes('P') && Disbursement[key]['v']==0){
                            delete Disbursement[key];
                        }else if(key.includes('Q') && Disbursement[key]['v']==''){
                            delete Disbursement[key];
                        }else if(key.includes('R') && Disbursement[key]['v']==''){
                            delete Disbursement[key]
                        }else if(key.includes('F')){
                            for (const [sub_key] of Object.entries(Disbursement[key])) {
                                if (sub_key != 'w'){
                                    delete Disbursement[key][sub_key]
                                }
                            }
                        }else if(key.includes('A')){
                            let num = parseInt(key.split('A')[1]);
                            if (num>11){
                                delete Disbursement[key]
                            }else{
                                for (const [sub_key] of Object.entries(Disbursement[key])) {
                                    if (sub_key != 'v'){
                                        delete Disbursement[key][sub_key]
                                    }
                                }
                            }
                        }else{
                            for (const [sub_key] of Object.entries(Disbursement[key])) {
                                if (sub_key != 'v'){
                                    delete Disbursement[key][sub_key]
                                }
                            }
                        }
                    }
                    let quarter = $("#quarter").val();
                    await renderAll(
                        AnnualBudget,
                        Roth,
                        Bank,
                        Receipt,
                        Disbursement,
                        quarter
                    );
                }
                reader.onerror = reject;
                reader.readAsBinaryString(file);
            });
        } catch (error) {
            throw error;
        }
    }
    async function renderAll(sheet_anual_budget,sheet_gov,sheet_bank,sheet_receipt,sheet_disbursement,quarter) {

            var myroute = `https://sof.efmsmoeys.com/sof/report_upload/read_all`;
            $.ajaxSetup({
                headers: {
                    'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
                }
            });
            let data = {
                    sheet_anual_budget:sheet_anual_budget,
                    sheet_gov:sheet_gov,
                    sheet_bank:sheet_bank,
                    sheet_receipt:sheet_receipt,
                    sheet_disbursement:sheet_disbursement,
                    quarter:quarter
                }
            await $.ajax({
                type: "post",
                url: myroute,
                data: data,
                dataType: 'json',
                beforeSend: function (xhr) {
                    // waiting.waitingUI('block');
                },
                success: function (result) {
                    $('#p0').html(result.all_sheet.sheet_anual_budget);
                    $('#p1').html(result.all_sheet.sheet_gov);
                    $('#p2').html(result.all_sheet.sheet_bank);
                    $('#p3').html(result.all_sheet.sheet_receipt);
                    $('#p4').html(result.all_sheet.sheet_disbursement);
                    waiting.waitingUI('none');
                },
                error: function (xhr) {
                    let result = JSON.parse(xhr.responseText);
                    switch (result.code) {
                        case 400:
                            let validate = "";
                            let i = 1;
                            for (const elem in result.errors) {
                                validate += `<br>${i}: ${elem}<br>`;
                                i++;
                            }
                            iziToast.error({
                                title: result.code,
                                titleSize: '18',
                                timeout: 8000,
                                message: result.message,
                                titlmessageSize: '14',
                                maxWidth: 700,
                                position: 'topRight',
                                progressBarColor: '#fa0505',
                            });
                            waiting.waitingUI('none');
                            break;
                        default:
                            iziToast.error({
                                title: result.code,
                                titleSize: '18',
                                timeout: 8000,
                                message: result.message,
                                titlmessageSize: '14',
                                maxWidth: 700,
                                position: 'topRight',
                                progressBarColor: '#fa0505',
                            });
                            waiting.waitingUI('none');
                    }
                }
            });
            return true;

    }
    function storeReport(formId,postTo){
        let quarter = $("#quarter").val();
        let formData = $("#"+formId).serialize();
        formData += `&quarter=${encodeURIComponent(quarter)}`;
        $.ajaxSetup({
            headers: {
                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
            }
        });
        $.ajax({
            type: "post",
            url: postTo,
            dataType: 'json',
            data: formData,
            beforeSend: function (xhr) {
                waiting.waitingUI('block');
            },
            success: function (result) {
                // $('#view_modal').modal('toggle');
                $("#quarter").removeAttr("disabled");
                $('#p0').html('');
                $('#p1').html('');
                $('#p2').html('');
                $('#p3').html('');
                $('#p4').html('');
                $('#btn_submit_report').attr("disabled", true);
                $('#excel_file').val('');
                iziToast.success({
                    title: "",
                    titleSize: '18',
                    timeout: 8000,
                    message: "Data is successfully saved.",
                    titlmessageSize: '14',
                    position: 'topRight',
                    progressBarColor: '#1100FF',
                });
                waiting.waitingUI('none');
            },
            error: function (xhr) {
                let result =JSON.parse(xhr.responseText);
                switch (xhr.status) {
                    case 400:
                        let validate = "";
                        let i = 1;
                        for (const elem of Object.entries(result.errors)) {
                            validate += `<br>${i}: ${elem[1]}<br>`;
                            i++;
                        }
                        iziToast.error({
                            title: '',
                            titleSize: '18',
                            timeout: 8000,
                            message: validate,
                            titlmessageSize: '14',
                            maxWidth: 700,
                            position: 'topRight',
                            progressBarColor: '#fa0505',
                        });
                        let validate_msg = Object.keys(result.errors);
                        validateShow(validate_msg,formData);
                        break;
                    default:
                        iziToast.error({
                            title: '',
                            titleSize: '18',
                            timeout: 8000,
                            message: result.message,
                            titlmessageSize: '14',
                            maxWidth: 700,
                            position: 'topRight',
                            progressBarColor: '#fa0505',
                        });
                }
                waiting.waitingUI('none');
            }
        });
        return false;
    }
    function checkQuarter(){
        $('#excel_file').removeAttr("disabled");
    }
    // $('.popoverData').popover();
</script><script src="https://sof.efmsmoeys.com/assets/js/read_excel_as_row.js"></script>
<div class="modal" id="view_modal"></div>
<div class="modal" id="view_modal_detail"></div>
<script src="https://sof.efmsmoeys.com/assets/js/xlsx.full.min.js"></script>
<script>
  // ok
  function setPaginationBPUpload(pagination) {
    $('#notications').pagination({
      total: pagination.total_items,
      current: pagination.page,
      length: pagination.count,
      size: 2,
      click: function (options, $target) {
        searchBudgetPlanning(options.current, options.length);
      }
    });
  }

  function searchBudgetPlanning(page = 1, count = 10) {
    var myroute = `https://sof.efmsmoeys.com/sof/search`;
    $.ajaxSetup({
      headers: {
        'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
      }
    });
    $.ajax({
      type: "post",
      url: myroute,
      data: {
        fiscal_year: $(".search_fiscal_year").val(),
        poe_id: $(".search_poe").val(),
        doe_id: $(".search_doe").val(),
        school_id: $(".search_school").val(),
        page: page,
        count: count,
      },
      dataType: 'json',
      beforeSend: function (xhr) {
        waiting.waitingUI('block');
      },
      success: function (result) {
        if (result.message !== undefined && result.message === 'success') {
          var table = $("#budget_planning_table");
          table.html(result.table);
          var search_box = document.querySelector("#searchDropdown");
          if (search_box.classList.contains("show")) {
            search_box.classList.toggle('show');
          }
          setPaginationBPUpload(result.pagination);
        } else {
          iziToast.warning({
            title: "",
            titleSize: '18',
            timeout: 8000,
            message: "Sorry, we could not find the data you are looking for.",
            titlmessageSize: '14',
            position: 'topRight',
            progressBarColor: '#fa0505',
          });
        }
        waiting.waitingUI('none');
      },
      error: function (xhr) {
        let result = JSON.parse(xhr.responseText);
        switch (result.code) {
          case 400:
            let validate = "";
            let i = 1;
            for (const elem in result.errors) {
              validate += `<br>${i}: ${elem}<br>`;
              i++;
            }
            iziToast.error({
              title: result.code,
              titleSize: '18',
              timeout: 8000,
              message: result.message,
              titlmessageSize: '14',
              maxWidth: 700,
              position: 'topRight',
              progressBarColor: '#fa0505',
            });
            waiting.waitingUI('none');
            break;
          default:
            iziToast.error({
              title: result.code,
              titleSize: '18',
              timeout: 8000,
              message: result.message,
              titlmessageSize: '14',
              maxWidth: 700,
              position: 'topRight',
              progressBarColor: '#fa0505',
            });
            waiting.waitingUI('none');
        }
      }
    });
    return false;
  }

  // ok
  function showUploadBudgetPlan(route) {
    $.ajaxSetup({
      headers: {
        'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
      }
    });
    $.ajax({
      type: "get",
      url: route,
      dataType: 'json',
      beforeSend: function (xhr) {
        waiting.waitingUI('block');
      },
      success: function (result) {
        $("#view_modal").html(result.modal);
        $("#view_modal").modal('toggle');
        waiting.waitingUI('none');
      },
      error: function (xhr) {
        let result = JSON.parse(xhr.responseText);
        switch (result.code) {
          case 400:
            let validate = "";
            let i = 1;
            for (const elem in result.errors) {
              validate += `<br>${i}: ${elem}<br>`;
              i++;
            }
            iziToast.error({
              title: result.code,
              titleSize: '18',
              timeout: 8000,
              message: result.validate,
              titlmessageSize: '14',
              maxWidth: 700,
              position: 'topRight',
              progressBarColor: '#fa0505',
            });
            waiting.waitingUI('none');
            break;
          default:
            iziToast.error({

              title: result.code,
              titleSize: '18',
              timeout: 8000,
              message: result.validate,
              titlmessageSize: '14',
              maxWidth: 700,
              position: 'topRight',
              progressBarColor: '#fa0505',
            });
            waiting.waitingUI('none');
        }
      }
    });
    return false;
  }

  // ok
  async function readFileAsyncPlanning(file) {
    return new Promise((resolve, reject) => {
      let reader = new FileReader();
      reader.onload = () => {
        resolve(test(reader.result));
      };

      async function test(result) {
        var fileData = result;
        return XLSX.read(fileData, {type: 'binary'});
      }

      reader.onerror = reject;
      reader.readAsBinaryString(file);
    })
  }

  async function readExcelPlanning() {
    try {
      $("#btn_submit_upload_plan").attr("disabled", true);
      //hide tabs
      $('#sub_level').addClass('d-none');
      $('#meeting').addClass('d-none');
      $('#other_info').addClass('d-none');

      waiting.waitingUI('block');
      var input = event.target;
      let wb = await readFileAsyncPlanning(input.files[0]);

      let param = {};
      let SCHOOL_INFOS = wb.Sheets['School Information'];
      // if(SCHOOL_INFOS['G35']['v'].includes("មានប្រតិបត្តិការមិនជោគជ័យ!") || SCHOOL_INFOS['G36']['v'].includes("មានប្រតិបត្តិការមិនជោគជ័យ!") || SCHOOL_INFOS['G37']['v'].includes("មានប្រតិបត្តិការមិនជោគជ័យ!") || SCHOOL_INFOS['G38']['v'].includes("មានប្រតិបត្តិការមិនជោគជ័យ!")){
      //     iziToast.error({
      //         title: 'ការទាញយកមិនបានជោគជ័យ!',
      //         titleSize: '18',
      //         timeout: 8000,
      //         message: 'សូមពិនិត្យប្រតិបត្តិការមិនជោគជ័យ!នៅក្នុង Sheet School Information ជួរដេកទី ៣៥ ដល់ ៣៨។',
      //         titlmessageSize: '14',
      //         maxWidth: 700,
      //         position: 'topRight',
      //         progressBarColor: '#fa0505',
      //     });
      //     // return
      // }
      for (let [key] of Object.entries(SCHOOL_INFOS)) {
        if (key.includes('!')) {
          delete SCHOOL_INFOS[key];
        } else {
          for (const [sub_key] of Object.entries(SCHOOL_INFOS[key])) {
            if (sub_key != 'v') {
              delete SCHOOL_INFOS[key][sub_key]
            }
          }
        }
      }
      param.school_info = SCHOOL_INFOS;

      // ==========> Sheet សម្រង់ស្ថិតិសាលារៀន
      let sch_statistics = wb.Sheets['សម្រង់ស្ថិតិសាលារៀន'];
      // Validate data first
      let sch_sta_validate = validateSchoolStatistics(sch_statistics)
      if (sch_sta_validate !== undefined) {
        if (sch_sta_validate.status === false) {
          iziToast.error({
            title: `ការទាញយកមិនបានជោគជ័យ ${sch_sta_validate.sheet ?? ''}`,
            titleSize: '18',
            timeout: 8000,
            message: sch_sta_validate.message,
            titlmessageSize: '14',
            maxWidth: 700,
            position: 'topRight',
            progressBarColor: '#fa0505',
          });
          $("#excel_file").val("")
          return
        }
      } else {
        for (let [key, value] of Object.entries(sch_statistics)) {
          if (sch_statistics[key]) {
            if (key.includes('!')) { // Not important data, so we don't need it.
              delete sch_statistics[key];
            } else {
              for (const [sub_key] of Object.entries(sch_statistics[key])) {
                if (sub_key != 'v') {
                  delete sch_statistics[key][sub_key] // remove sub key that not eqal to 'v'. Ex: one record(row) has ['v', 't', 'w']
                }
              }
            }
          }
        }
        param.sch_statistics = sch_statistics;
      }

      let bsp_indicator = wb.Sheets['BSP_Indicator'];
      // Validate data first
      let bsp_indicator_validate = validateBspIndicator(bsp_indicator)
      if (bsp_indicator_validate !== undefined) {
        if (bsp_indicator_validate.status === false) {
          iziToast.error({
            title: `ការទាញយកមិនបានជោគជ័យ ${bsp_indicator_validate.sheet ?? ''}`,
            titleSize: '18',
            timeout: 8000,
            message: bsp_indicator_validate.message,
            titlmessageSize: '14',
            maxWidth: 700,
            position: 'topRight',
            progressBarColor: '#fa0505',
          });
          $("#excel_file").val("")
          return
        }
      } else {
        for (let [key, value] of Object.entries(bsp_indicator)) {
          if (bsp_indicator[key]) {
            if (key.includes('!')) { // Not important data, so we don't need it.
              delete bsp_indicator[key];
            } else {
              for (const [sub_key] of Object.entries(bsp_indicator[key])) {
                if (sub_key != 'v') {
                  delete bsp_indicator[key][sub_key] // remove sub key that not eqal to 'v'. Ex: one record(row) has ['v', 't', 'w']
                }
              }
            }
          }
        }
        param.bsp_indicator = bsp_indicator;
      }

      let activity = wb.Sheets['ACTIVITY'];
      // Validate data first
      let activity_validate = validateActivity(activity)
      if (activity_validate !== undefined) {
        if (activity_validate.status === false) {
          iziToast.error({
            title: `ការទាញយកមិនបានជោគជ័យ ${activity_validate.sheet ?? ''}`,
            titleSize: '18',
            timeout: 8000,
            message: activity_validate.message,
            titlmessageSize: '14',
            maxWidth: 700,
            position: 'topRight',
            progressBarColor: '#fa0505',
          });
          $("#excel_file").val("")
          return
        }
      } else {
        for (let [key, value] of Object.entries(activity)) {
          if (activity[key]) {
            if (key.includes('!')) { // Not important data, so we don't need it.
              delete activity[key];
            } else {
              for (const [sub_key] of Object.entries(activity[key])) {
                if (sub_key != 'v') {
                  delete activity[key][sub_key] // remove sub key that not eqal to 'v'. Ex: one record(row) has ['v', 't', 'w']
                }
              }
            }
          }
        }
        param.activity = activity;
      }

      if (wb.Sheets['School Information']['G19'] && wb.Sheets['School Information']['G19']['v'] === 'មាន') {
        let activity_sub_level = wb.Sheets['ACTIVITY_SUB_LEVEL'];
        // Validate data first
        let sub_activity_validate = validateSubActivity(activity_sub_level)
        if (sub_activity_validate !== undefined) {
          if (sub_activity_validate.status === false) {
            iziToast.error({
              title: `ការទាញយកមិនបានជោគជ័យ ${sub_activity_validate.sheet ?? ''}`,
              titleSize: '18',
              timeout: 8000,
              message: sub_activity_validate.message,
              titlmessageSize: '14',
              maxWidth: 700,
              position: 'topRight',
              progressBarColor: '#fa0505',
            });
            $("#excel_file").val("")
            return
          }
        } else {
          for (let [key, value] of Object.entries(activity_sub_level)) {
            if (activity_sub_level[key]) {
              if (key.includes('!')) { // Not important data, so we don't need it.
                delete activity_sub_level[key];
              } else {
                for (const [sub_key] of Object.entries(activity_sub_level[key])) {
                  if (sub_key != 'v') {
                    delete activity_sub_level[key][sub_key] // remove sub key that not eqal to 'v'. Ex: one record(row) has ['v', 't', 'w']
                  }
                }
              }
            }
          }
          param.activity_sub_level = activity_sub_level;
        }
      }

      let SOF = wb.Sheets['SOF'];
      // Validate data first
      let SOF_validate = validateSOF(SOF)
      if (SOF_validate !== undefined) {
        if (SOF_validate.status === false) {
          iziToast.error({
            title: `ការទាញយកមិនបានជោគជ័យ ${SOF_validate.sheet ?? ''}`,
            titleSize: '18',
            timeout: 8000,
            message: SOF_validate.message,
            titlmessageSize: '14',
            maxWidth: 700,
            position: 'topRight',
            progressBarColor: '#fa0505',
          });
          $("#excel_file").val("")
          return
        }
      } else {
        for (let [key, value] of Object.entries(SOF)) {
          if (SOF[key]) {
            if (key.includes('!')) {
              delete SOF[key];
            } else if (
                key.includes('T')
                || key.includes('U')
                || key.includes('AA')
                || key.includes('AB')
                || key.includes('AC')
                || key.includes('AD')
                || key.includes('AE')
                || key.includes('AF')
                || key.includes('AG')
                || key.includes('AI')
                || key.includes('AJ')
                || key.includes('AK')
                || key.includes('AL')
                || key.includes('AM')
                || key.includes('AN')
                || key.includes('AO')
                || key.includes('AP')
                || key.includes('AQ')
                || key.includes('AR')
                || key.includes('AS')
                || key.includes('AX')
            ) {
              delete SOF[key];
            } else if (
                (
                    key.includes('H')
                    || key.includes('J')
                    || key.includes('K')
                    || key.includes('M')
                    || key.includes('O')
                    || key.includes('P')
                    || key.includes('Q')
                    || key.includes('R')
                )
                && value.v === 0
            ) {
              let sp = '';
              if (key.includes('H')) {
                sp = 'H';
              } else if (key.includes('J')) {
                sp = 'J';
              } else if (key.includes('K')) {
                sp = 'K';
              } else if (key.includes('M')) {
                sp = 'M';
              } else if (key.includes('O')) {
                sp = 'O';
              } else if (key.includes('P')) {
                sp = 'P';
              } else if (key.includes('Q')) {
                sp = 'Q';
              } else {
                sp = 'R';
              }
              let num = parseInt(key.split(sp)[1]);
              if (num > 11 && num != 212 && num != 413 && num != 414 && num != 615 && num != 816 && num != 1017) {
                delete SOF[key];
              } else {
                for (const [sub_key] of Object.entries(SOF[key])) {
                  if (sub_key !== 'v') {
                    delete SOF[key][sub_key]
                  }
                }
              }

            } else if (key.includes('S') && !key.includes('AS') && value.v === 0) {
              let num = parseInt(key.split('S')[1]);
              if (num > 11 && num != 212 && num != 413 && num != 414 && num != 615 && num != 816 && num != 1017) {
                delete SOF[key];
                SOF['AV' + num] ? delete SOF['AV' + num] : '';
                SOF['AW' + num] ? delete SOF['AW' + num] : '';
              } else {
                for (const [sub_key] of Object.entries(SOF[key])) {
                  if (sub_key !== 'v') {
                    delete SOF[key][sub_key]
                  }
                }
              }

            } else {
              for (const [sub_key] of Object.entries(SOF[key])) {
                if (sub_key != 'v') {
                  delete SOF[key][sub_key]
                }
              }
            }
          }
        }

        param.sheetSofP2 = SOF;
      }

      if (wb.Sheets['School Information']['G19'] && wb.Sheets['School Information']['G19']['v'] === 'មាន') {
        let SOF_SUB_LEVEL = wb.Sheets['SOF_SUB_LEVEL'];
        // Validate data first
        let SOF_SUB_LEVEL_validate = validateSubSOF(SOF_SUB_LEVEL)
        if (SOF_SUB_LEVEL_validate !== undefined) {
          if (SOF_SUB_LEVEL_validate.status === false) {
            iziToast.error({
              title: `ការទាញយកមិនបានជោគជ័យ ${SOF_SUB_LEVEL_validate.sheet ?? ''}`,
              titleSize: '18',
              timeout: 8000,
              message: SOF_SUB_LEVEL_validate.message,
              titlmessageSize: '14',
              maxWidth: 700,
              position: 'topRight',
              progressBarColor: '#fa0505',
            });
            $("#excel_file").val("")
            return
          }
        } else {
          for (let [key, value] of Object.entries(SOF_SUB_LEVEL)) {
            if (SOF_SUB_LEVEL[key]) {
              if (key.includes('!')) {
                delete SOF_SUB_LEVEL[key];
              } else if (
                  key.includes('T')
                  || key.includes('U')
                  || key.includes('AA')
                  || key.includes('AB')
                  || key.includes('AC')
                  || key.includes('AD')
                  || key.includes('AE')
                  || key.includes('AF')
                  || key.includes('AG')
                  || key.includes('AI')
                  || key.includes('AJ')
                  || key.includes('AK')
                  || key.includes('AL')
                  || key.includes('AM')
                  || key.includes('AN')
                  || key.includes('AO')
                  || key.includes('AP')
                  || key.includes('AQ')
                  || key.includes('AR')
                  || key.includes('AS')
                  || key.includes('AX')
              ) {
                delete SOF_SUB_LEVEL[key];
              } else if (
                  (
                      key.includes('H')
                      || key.includes('J')
                      || key.includes('K')
                      || key.includes('M')
                      || key.includes('O')
                      || key.includes('P')
                      || key.includes('Q')
                      || key.includes('R')
                  )
                  && value.v === 0
              ) {
                let sp = '';
                if (key.includes('H')) {
                  sp = 'H';
                } else if (key.includes('J')) {
                  sp = 'J';
                } else if (key.includes('K')) {
                  sp = 'K';
                } else if (key.includes('M')) {
                  sp = 'M';
                } else if (key.includes('O')) {
                  sp = 'O';
                } else if (key.includes('P')) {
                  sp = 'P';
                } else if (key.includes('Q')) {
                  sp = 'Q';
                } else {
                  sp = 'R';
                }
                let num = parseInt(key.split(sp)[1]);
                if (num > 11 && num != 212 && num != 413 && num != 414 && num != 615 && num != 816 && num != 1017) {
                  delete SOF_SUB_LEVEL[key];
                } else {
                  for (const [sub_key] of Object.entries(SOF_SUB_LEVEL[key])) {
                    if (sub_key != 'v') {
                      delete SOF_SUB_LEVEL[key][sub_key]
                    }
                  }
                }

              } else if (key.includes('S') && !key.includes('AS') && value.v === 0) {
                let num = parseInt(key.split('S')[1]);
                if (num > 11 && num != 212 && num != 413 && num != 414 && num != 615 && num != 816 && num != 1017) {
                  delete SOF_SUB_LEVEL[key];
                  SOF_SUB_LEVEL['AV' + num] ? delete SOF_SUB_LEVEL['AV' + num] : '';
                  SOF_SUB_LEVEL['AW' + num] ? delete SOF_SUB_LEVEL['AW' + num] : '';
                } else {
                  for (const [sub_key] of Object.entries(SOF_SUB_LEVEL[key])) {
                    if (sub_key != 'v') {
                      delete SOF_SUB_LEVEL[key][sub_key]
                    }
                  }
                }
              } else {
                for (const [sub_key] of Object.entries(SOF_SUB_LEVEL[key])) {
                  if (sub_key != 'v') {
                    delete SOF_SUB_LEVEL[key][sub_key]
                  }
                }
              }
            }
          }
          param.sheetSofP3 = SOF_SUB_LEVEL;
        }
      }

      let OTHER_INFO = wb.Sheets['OTHER_INFO'];
      for (let [key] of Object.entries(OTHER_INFO)) {
        if (key.includes('!')) {
          delete OTHER_INFO[key];
        } else {
          for (const [sub_key] of Object.entries(OTHER_INFO[key])) {
            if (sub_key !== 'v') {
              delete OTHER_INFO[key][sub_key]
            }
          }
        }
      }
      param.other_info = OTHER_INFO;


      let MEETING = wb.Sheets['MEETING'];
      for (let [key] of Object.entries(MEETING)) {
        if (MEETING[key]) {
          if (key.includes('!')) {
            delete MEETING[key];
          } else if (key.includes('E')) {
            if (isNaN(parseInt(MEETING[key]['v']))) {
              let num = key.split('E')[1];
              if (num > 9 && num !== 24 && num !== 25 && num !== 37 && num !== 45 && num !== 46) {
                MEETING['G' + num] ? delete MEETING['G' + num] : '';
                MEETING['H' + num] ? delete MEETING['H' + num] : '';
                MEETING['I' + num] ? delete MEETING['I' + num] : '';
                MEETING['A' + num] ? delete MEETING['A' + num] : '';
                MEETING['D' + num] ? delete MEETING['D' + num] : '';
                delete MEETING[key];
              } else {
                for (const [sub_key, value] of Object.entries(MEETING[key])) {
                  if (sub_key !== 'v') {
                    delete MEETING[key][sub_key]
                  }
                }
              }
            } else {
              for (const [sub_key, value] of Object.entries(MEETING[key])) {
                if (sub_key !== 'v') {
                  delete MEETING[key][sub_key]
                }
              }
            }

          } else {
            for (const [sub_key, value] of Object.entries(MEETING[key])) {
              if (sub_key !== 'v') {
                delete MEETING[key][sub_key]
              }
            }
          }
        }
      }
      param.meeting = MEETING;

      let bsp = wb.Sheets['BSP'];
      // Validate data first
      let BSP_validate = validateBSP(bsp)
      if (BSP_validate !== undefined) {
        if (BSP_validate.status === false) {
          iziToast.error({
            title: `ការទាញយកមិនបានជោគជ័យ ${BSP_validate.sheet ?? ''}`,
            titleSize: '18',
            timeout: 8000,
            message: BSP_validate.message,
            titlmessageSize: '14',
            maxWidth: 700,
            position: 'topRight',
            progressBarColor: '#fa0505',
          });
          $("#excel_file").val("")
          return
        }
      } else {
        for (let [key, value] of Object.entries(bsp)) {
          if (bsp[key]) {
            if (key.includes('!')) { // Not important data, so we don't need it.
              delete bsp[key];
            } else {
              for (const [sub_key] of Object.entries(bsp[key])) {
                if (sub_key !== 'v') {
                  delete bsp[key][sub_key] // remove sub key that not eqal to 'v'. Ex: one record(row) has ['v', 't', 'w']
                }
              }
            }
          }
        }
        param.bsp = bsp;
      }

      let aop = wb.Sheets['AOP'];
      // Validate data first
      let aopValidate = validateAOP(aop)
      if (aopValidate !== undefined) {
        if (aopValidate.status === false) {
          iziToast.error({
            title: `ការទាញយកមិនបានជោគជ័យ ${aopValidate.sheet ?? ''}`,
            titleSize: '18',
            timeout: 8000,
            message: aopValidate.message,
            titlmessageSize: '14',
            maxWidth: 700,
            position: 'topRight',
            progressBarColor: '#fa0505',
          });
          $("#excel_file").val("")
          return
        }
      } else {
        for (let [key, value] of Object.entries(aop)) {
          if (aop[key]) {
            if (key.includes('!')) { // Not important data, so we don't need it.
              delete aop[key];
            } else {
              for (const [sub_key] of Object.entries(aop[key])) {
                if (sub_key !== 'v') {
                  delete aop[key][sub_key] // remove sub key that not eqal to 'v'. Ex: one record(row) has ['v', 't', 'w']
                }
              }
            }
          }
        }
        param.aop = aop;
      }
      await readAllSheet(param);
      $("#btn_submit_upload_plan").removeAttr("disabled");
    } catch (err) {
      $("#btn_submit_upload_plan").attr("disabled", true);
      iziToast.error({
        title: 'ការទាញយកមិនបានជោគជ័យ!',
        titleSize: '18',
        timeout: 8000,
        message: 'មិនអាចទាញយកទិន្នន័យគ្រោងថវិកាពីប្រព័ន្ធ Excel ដែលបានជ្រើសរើស។ សូមប្រាកដថា File ដែលលោកអ្នកបានជ្រើសរើសគឺជាប្រព័ន្ធគ្រោងថវិកាមូលនិធិដំណើរការសាលារៀនសាធារណៈ Excel .xlsb។ សូមអរគុណ!',
        titlmessageSize: '14',
        maxWidth: 700,
        position: 'topRight',
        progressBarColor: '#fa0505',
      });
      $('#p0').html('');
      $('#p1').html('');
      $('#p2').html('');
      $('#p3').html('');
      $('#p4').html('');
      $('#p4').html('');
      $('#p5').html('');
      $('#p6').html('');
      $('#p7').html('');
      $('#p8').html('');
      $("#excel_file").val("")
      // $('#p9').html('');
      // $('#p10').html('');
    } finally {
      waiting.waitingUI('none');
    }
  }

  async function getRowNumberFromExcel(key) {
    return key.match(/\d+/g)[0];
  }

  async function readAllSheet(param) {
    try {
      var myroute = `https://sof.efmsmoeys.com/sof/upload_budget_plan/read_all_sheet`;
      $.ajaxSetup({
        headers: {
          'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
        }
      });
      await $.ajax({
        type: "post",
        url: myroute,
        data: param,
        dataType: 'json',
        beforeSend: function (xhr) {
          // waiting.waitingUI('block');
        },
        success: function (result) {
          if (result.all_sheet.school_info) {
            $('#p0').html(result.all_sheet.school_info);
          }
          if (result.all_sheet.other_info) {
            $('#p1').html(result.all_sheet.other_info);
            $('#other_info').removeClass('d-none');
          }
          if (result.all_sheet.sheetSofP2) {
            $('#p2').html(result.all_sheet.sheetSofP2);
          }
          if (result.all_sheet.meeting) {
            $('#p4').html(result.all_sheet.meeting);
            $('#meeting').removeClass('d-none');
          }
          if (result.all_sheet.sheetSofP3) {
            $('#p3').html(result.all_sheet.sheetSofP3);
            $('#sub_level').removeClass('d-none');
          }
          if (result.all_sheet.bsp_indicator) {
            $('#p5').html(result.all_sheet.bsp_indicator);
            $('#bsp_indicator').removeClass('d-none');
          }
          if (result.all_sheet.bsp) {
            $('#p6').html(result.all_sheet.bsp);
            $('#bsp').removeClass('d-none');
          }
          if (result.all_sheet.aop) {
            $('#p7').html(result.all_sheet.aop);
            $('#aop').removeClass('d-none');
          }
          if (result.all_sheet.sch_statistics) {
            $('#p8').html(result.all_sheet.sch_statistics);
            $('#school_statistics').removeClass('d-none');
          }
          // if(result.all_sheet.activity){
          //     $('#p9').html(result.all_sheet.activity);
          //     $('#activity').removeClass('d-none');
          // }
          // if(result.all_sheet.activity_sub_level){
          //     $('#p10').html(result.all_sheet.activity_sub_level);
          //     $('#activity_sub_level').removeClass('d-none');
          // }
        },
        error: function (xhr) {
          let result = JSON.parse(xhr.responseText);
          switch (result.code) {
            case 400:
              let validate = "";
              let i = 1;
              for (const elem in result.errors) {
                validate += `<br>${i}: ${elem}<br>`;
                i++;
              }
              iziToast.error({
                title: result.code,
                titleSize: '18',
                timeout: 8000,
                message: result.message,
                titlmessageSize: '14',
                maxWidth: 700,
                position: 'topRight',
                progressBarColor: '#fa0505',
              });
              waiting.waitingUI('none');
              break;
            default:
              iziToast.error({
                title: result.code,
                titleSize: '18',
                timeout: 8000,
                message: result.message,
                titlmessageSize: '14',
                maxWidth: 700,
                position: 'topRight',
                progressBarColor: '#fa0505',
              });
              waiting.waitingUI('none');
          }
        }
      });
      return true;
    } catch (error) {
      throw error;
    }
  }

  function storePlan(formId, postTo) {

    try {
      let formData = $("#" + formId).serialize();
      $.ajaxSetup({
        headers: {
          'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
        }
      });
      $.ajax({
        type: "post",
        url: postTo,
        data: formData,
        dataType: 'json',
        beforeSend: function (xhr) {
          waiting.waitingUI('block');
        },
        success: function (result) {
          $('#view_modal').modal('toggle');
          iziToast.success({
            title: "",
            titleSize: '18',
            timeout: 8000,
            message: "Data is successfully saved.",
            titlmessageSize: '14',
            position: 'topRight',
            progressBarColor: '#1100FF',
          });
          waiting.waitingUI('none');
        },
        error: function (xhr) {
          let result = JSON.parse(xhr.responseText);
          if (!result.code) {
            switch (xhr.status) {
              case 400:
                let validate = "";
                let i = 1;
                for (const elem in result.errors) {
                  validate += `<br>${i}: ${result.errors[elem]}<br>`;
                  i++;
                }
                iziToast.error({
                  title: "ប្រតិបត្តិការមិនជោគជ័យ!",
                  titleSize: '18',
                  timeout: 8000,
                  message: validate,
                  titlmessageSize: '14',
                  maxWidth: 700,
                  position: 'topRight',
                  progressBarColor: '#fa0505',
                });
                break;
            }
          } else {
            switch (result.code) {
              case 400:
                let validate = "";
                let i = 1;
                for (const elem in result.errors) {
                  validate += `<br>${i}: ${elem}<br>`;
                  i++;
                }
                iziToast.error({
                  title: result.code,
                  titleSize: '18',
                  timeout: 8000,
                  message: result.message,
                  titlmessageSize: '14',
                  maxWidth: 700,
                  position: 'topRight',
                  progressBarColor: '#fa0505',
                });
                break;
              default:
                iziToast.error({
                  title: result.code,
                  titleSize: '18',
                  timeout: 8000,
                  message: result.message,
                  titlmessageSize: '14',
                  maxWidth: 700,
                  position: 'topRight',
                  progressBarColor: '#fa0505',
                });
            }
          }

          waiting.waitingUI('none');
        }
      });
      return true;
    } catch (error) {
      throw error;
    }
  }

  function deletePlanning(myroute, rowValue, page) {
    swal(
        {
          title: "Confirm",
          text: "Do you really want to delete this data?",
          type: "warning",
          showCancelButton: true,
          confirmButtonText: "Yes",
          cancelButtonText: "No",
          buttons: {
            cancel: {
              className: "btn btn-info",
            },
            confirm: {
              className: "btn btn-danger",
            },
          },
        },
        function (isConfirm) {
          if (isConfirm) {
            rowValue = $(rowValue).closest("tr").find("td:eq(0)").text();
            $.ajaxSetup({
              headers: {
                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
              }
            });
            $.ajax({
              type: "post",
              url: myroute,
              // data:{
              //     'id': id,
              // },
              data: {
                page: page
              },
              dataType: 'json',
              beforeSend: function (xhr) {
                waiting.waitingUI('block');
              },
              success: function (results) {
                $('#receipt_table_body tr:last').remove();
                searchBudgetPlanning(Math.ceil(rowValue / 10), 10);
                iziToast.success({
                  title: "",
                  titleSize: '18',
                  timeout: 8000,
                  message: "Data is successfully deleted.",
                  titlmessageSize: '14',
                  position: 'topRight',
                  progressBarColor: '#1100FF',
                });
                waiting.waitingUI('none');
              },
              error: function (xhr, status, error) {
                let returnBack = JSON.parse(xhr.responseText);
                switch (xhr.status) {
                  case 400:
                    let validate = "";
                    let i = 1;
                    for (const elem of Object.entries(returnBack.errors)) {
                      validate += `<br>${i}: ${elem[1]}<br>`;
                      i++;
                    }
                    iziToast.error({
                      //color:'#f55742',
                      title: "Require Input",
                      titleSize: '18',
                      //titleColor: '',
                      timeout: 8000,
                      message: validate,
                      titlmessageSize: '14',
                      //messageColor: '',
                      maxWidth: 700,
                      position: 'topRight',
                      progressBarColor: '#fa0505',
                    });
                    waiting.waitingUI('none');
                    break;
                  default:
                    iziToast.error({
                      //color:'#f55742',
                      title: returnBack.code,
                      titleSize: '18',
                      //titleColor: '',
                      timeout: 8000,
                      message: returnBack.message,
                      titlmessageSize: '14',
                      //messageColor: '',
                      maxWidth: 700,
                      position: 'topRight',
                      progressBarColor: '#fa0505',
                    });
                    waiting.waitingUI('none');
                }
              }
            });
          }

        }
    );
  }

  function viewPlanning(route) {
    $.ajaxSetup({
      headers: {
        'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
      }
    });
    $.ajax({
      type: "get",
      url: route,
      dataType: 'json',
      beforeSend: function (xhr) {
        waiting.waitingUI('block');
      },
      success: function (result) {
        $("#view_modal").html(result.modal);
        $("#view_modal").modal('show');
        waiting.waitingUI('none');
      },
      error: function (xhr) {
        let result = JSON.parse(xhr.responseText);
        switch (result.code) {
          case 400:
            let validate = "";
            let i = 1;
            for (const elem in result.errors) {
              validate += `<br>${i}: ${elem}<br>`;
              i++;
            }
            iziToast.error({
              title: result.code,
              titleSize: '18',
              timeout: 8000,
              message: result.message,
              titlmessageSize: '14',
              maxWidth: 700,
              position: 'topRight',
              progressBarColor: '#fa0505',
            });
            waiting.waitingUI('none');
            break;
          default:
            iziToast.error({

              title: result.code,
              titleSize: '18',
              timeout: 8000,
              message: result.message,
              titlmessageSize: '14',
              maxWidth: 700,
              position: 'topRight',
              progressBarColor: '#fa0505',
            });
            waiting.waitingUI('none');
        }
      }
    });
    return false;
  }

  // Validate AOP data
  function validateAOP(aop) {
    if (aop['N4'] === undefined || (aop['N4']['v'].toString().toLowerCase()).search('ref') > 0) {
      return {
        status: false,
        sheet: "AOP",
        message: "សូមពិនិត្យមើលថវិកាសរុបឡើងវិញនៅជួរឈរ N និងជួរដេកទី4"
      }
    }
  }

  // Validate data of school statistics
  function validateSchoolStatistics(sch_statistics) {
    let check
    // table 1
    check = has(sch_statistics, ['D6', 'H6', 'L6', 'D7', 'H7']);
    if (!check) {
      return {
        status: false,
        sheet: "សម្រង់ស្ថិតិសាលារៀន",
        message: "សូមបំពេញព័ត៍មានក្នុងតារាង ១. អំពីអ្នកបំពេញព័ត៌មាន អោយបានត្រឹមត្រូវ។"
      }
    }
    // table 2
    check = has(sch_statistics, ['H16', 'H17', 'H18', 'H21', 'H22', 'H25', 'H26', 'H29', 'H30']);
    if (!check) {
      return {
        status: false,
        sheet: "សម្រង់ស្ថិតិសាលារៀន",
        message: "សូមបំពេញព័ត៍មានក្នុងតារាង ២. ព័ត៌មានទូទៅ អោយបានត្រឹមត្រូវ។"
      }
    }
    // table 3
    let row_check = []
    for (let i = 35; i <= 54; i++) {
      sch_statistics[`C${i}`] === undefined ? row_check.push(true) : row_check.push(false)
      sch_statistics[`F${i}`] === undefined ? row_check.push(true) : row_check.push(false)
      sch_statistics[`G${i}`] === undefined ? row_check.push(true) : row_check.push(false)
      sch_statistics[`H${i}`] === undefined ? row_check.push(true) : row_check.push(false)
      sch_statistics[`J${i}`] === undefined ? row_check.push(true) : row_check.push(false)
      sch_statistics[`L${i}`] === undefined ? row_check.push(true) : row_check.push(false)
      if ((new Set(row_check)).size > 1) {
        return {
          status: false,
          sheet: "សម្រង់ស្ថិតិសាលារៀន",
          message: "សូមបំពេញព័ត៍មានក្នុងតារាង ៣. ប្រភពសិស្សដែលមករៀន អោយបានត្រឹមត្រូវ។"
        }
      }
      row_check = []
    }
    // table 4
    check = has(sch_statistics, ['D58', 'D59', 'D60', 'D61', 'D62', 'D63', 'D64', 'D65', 'G58', 'G59', 'G60', 'G61', 'G62', 'G63', 'G64', 'G65', 'J58', 'J59']);
    if (!check) {
      return {
        status: false,
        sheet: "សម្រង់ស្ថិតិសាលារៀន",
        message: "សូមបំពេញព័ត៍មានក្នុងតារាង ៤. ព័ត៌មាននៃការសិក្សា អោយបានត្រឹមត្រូវ។"
      }
    }
    // table 5
    check = has(sch_statistics, ['D71']);
    if (!check) {
      return {
        status: false,
        sheet: "សម្រង់ស្ថិតិសាលារៀន",
        message: "សូមបំពេញព័ត៍មានក្នុងតារាង ៥. ពត៌មានលម្អិតអំពីដី អោយបានត្រឹមត្រូវ។"
      }
    }
    // table 6
    let message = 'ក្នុងតារាង ៦. ស្ថានភាពអគារ។'
    let sheet = "សម្រង់ស្ថិតិសាលារៀន"
    let columnToCheck = ['C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q']
    for (let i = 79; i <= 98; i++) {
      let rowCheck = []
      columnToCheck.forEach((col) => {
        if (sch_statistics[`${col}${i}`] === undefined) {
          rowCheck.push(true)
        } else {
          rowCheck.push(false)
        }
      })
      if ((new Set(rowCheck)).size <= 1) {
        continue
      }

      if (sch_statistics[`C${i}`] === undefined) {
        message = `សូមបំពេញឆ្នាំសាងសង់នៅជួរដេកទី${i} ${message}`
        return {
          status: false,
          sheet: sheet,
          message: message
        }
      }

      if (sch_statistics[`D${i}`] === undefined) {
        message = `សូមជ្រើសរើសប្រភពមូលនិធិនៅជួរដេកទី${i} ${message}`
        return {
          status: false,
          sheet: sheet,
          message: message
        }
      } else {
        if (!/^\d+$/.test(sch_statistics[`D${i}`]['v'])) {
          message = `ប្រភពមូលនិធិត្រូវជាលេខកូដនៅជួរដេកទី${i} ${message}`
          return {
            status: false,
            sheet: sheet,
            message: message
          }
        }
      }

      // Must be one that !undefined
      if (sch_statistics[`E${i}`] === undefined && sch_statistics[`F${i}`] === undefined) {
        message = `សូមបំពេញចំនួនបន្ទប់នៅជួរដេកទី${i} ${message}`
        return {
          status: false,
          sheet: sheet,
          message: message
        }
      }

      // Must be one that !undefined
      if (sch_statistics[`G${i}`] === undefined && sch_statistics[`H${i}`] === undefined && sch_statistics[`I${i}`] === undefined && sch_statistics[`J${i}`] === undefined) {
        message = `សូមជ្រើសរើសកម្រាលនៅជួរដេកទី${i} ${message}`
        return {
          status: false,
          sheet: sheet,
          message: message
        }
      }

      if (sch_statistics[`K${i}`] === undefined) {
        message = `សូមជ្រើសរើសប្រភេទជញ្ជាំងនៅជួរដេកទី${i} ${message}`
        return {
          status: false,
          sheet: sheet,
          message: message
        }
      }

      if (sch_statistics[`L${i}`] === undefined) {
        message = `សូមជ្រើសរើសលក្ខណៈជញ្ជាំងនៅជួរដេកទី${i} ${message}`
        return {
          status: false,
          sheet: sheet,
          message: message
        }
      }

      if (sch_statistics[`M${i}`] === undefined) {
        message = `សូមជ្រើសរើសប្រភេទដំបូលនៅជួរដេកទី${i} ${message}`
        return {
          status: false,
          sheet: sheet,
          message: message
        }
      }

      if (sch_statistics[`N${i}`] === undefined) {
        message = `សូមជ្រើសរើសលក្ខណៈដំបូលនៅជួរដេកទី${i} ${message}`
        return {
          status: false,
          sheet: sheet,
          message: message
        }
      }

      if (sch_statistics[`Q${i}`] === undefined) {
        message = `សូមជ្រើសរើសស្ថានភាពអគារនៅជួរដេកទី${i} ${message}`
        return {
          status: false,
          sheet: sheet,
          message: message
        }
      }
    }
    // table 7
    row_check = []
    for (let i = 103; i <= 107; i++) {
      if (sch_statistics[`F${i}`] !== undefined) {
        row_check.push(false)
        // sch_statistics[`G${i}`] == undefined ? row_check.push(true) : row_check.push(false)
        // sch_statistics[`L${i}`] == undefined ? row_check.push(true) : row_check.push(false)
        if ((new Set(row_check)).size > 1) {
          return {
            status: false,
            sheet: "សម្រង់ស្ថិតិសាលារៀន",
            message: "សូមបំពេញព័ត៍មានក្នុងតារាង ៧. លទ្ធភាពនិងសំណូមពររបស់សហគមន៏ អោយបានត្រឹមត្រូវ។"
          }
        }
        row_check = []
      } else {
        delete sch_statistics[`G${i}`]
        delete sch_statistics[`L${i}`]
      }
    }
    // table 8
    row_check = []
    for (let i = 111; i <= 130; i++) {
      sch_statistics[`C${i}`] === undefined ? row_check.push(true) : row_check.push(false)
      sch_statistics[`F${i}`] === undefined ? row_check.push(true) : row_check.push(false)
      sch_statistics[`I${i}`] === undefined ? row_check.push(true) : row_check.push(false)
      sch_statistics[`K${i}`] === undefined ? row_check.push(true) : row_check.push(false)
      if ((new Set(row_check)).size > 1) {
        return {
          status: false,
          sheet: "សម្រង់ស្ថិតិសាលារៀន",
          message: "សូមបំពេញព័ត៍មានក្នុងតារាង ៨. ឈ្មោះគណៈកម្មការគ្រប់គ្រងសាលារៀន អោយបានត្រឹមត្រូវ។"
        }
      }
      row_check = []
    }
  }

  // Validate budget plan indicator data
  function validateBspIndicator(bsp_indicator) {
    let sheet = "BSP Indicator"
    let columnToCheck = ["I", "J", "L", "M"]
    let needVerifyThisRow = []
    for (let i = 11; i <= 1120; i++) {
      needVerifyThisRow = []
      // Required column(E) must be not empty
      if (bsp_indicator[`E${i}`] !== undefined && bsp_indicator[`E${i}`]['v'] !== '') {
        // Check if column E contain REF value
        if ((bsp_indicator[`E${i}`]['v'].toString().toLowerCase()).search("ref") > -1) {
          return {
            status: false,
            sheet: sheet,
            message: `សូមពិនិត្យមើលលេខកូដសូចនាករអោយបានត្រឹមត្រូវនៅជួរឈរ E និងជួរដេកទី ${i}`
          }
        }

        // Check if column E contain ST but their length not equal 9
        // It means this standard bsp indicator code are not correct format(contain=ST, length=9)
        if ((bsp_indicator[`E${i}`]['v'].toString()).search('ST') > -1) {
          if (bsp_indicator[`E${i}`]['v'].length !== 9) {
            return {
              status: false,
              sheet: sheet,
              message: `សូមពិនិត្យមើលលេខកូដសូចនាករអោយបានត្រឹមត្រូវនៅជួរឈរ E និងជួរដេកទី ${i}`
            }
          } else {
            if (bsp_indicator[`F${i}`] !== undefined) {
              if ((bsp_indicator[`F${i}`]['v'].toString().toLowerCase()).search("ref") > -1) {
                return {
                  status: false,
                  sheet: sheet,
                  message: `មាន REF នៅជួរឈរ F និងជួរដេកទី ${i}`
                }
              }

              if (bsp_indicator[`F${i}`]['v'] === '') {
                return {
                  status: false,
                  sheet: sheet,
                  message: `សូមពិនិត្យមើលសូចនាករអោយបានត្រឹមត្រូវនៅជួរឈរ F និងជួរដេកទី ${i}`
                }
              }
              columnToCheck.forEach((col) => {
                // If they fill any value in column to check
                // So we need to check this row to make sure data is correct
                bsp_indicator[`${col}${i}`] === undefined ? needVerifyThisRow.push(false) : needVerifyThisRow.push(true)
              })
              if ((new Set(needVerifyThisRow)).size > 1) {
                return {
                  status: false,
                  sheet: sheet,
                  message: `សូមពិនិត្យមើលការបញ្ចូលទិន្នន័យនៅជួរដេកទី${i} ឡើងវិញ`
                }
              }
            }
          }
        }
      }
    }
  }

  // Validate bsp data
  function validateBSP(bsp) {
    let sheet = "BSP"
    let columnToCheck = ["D", "E", "F", "G", "H", "I", "J", "AG", "AH", "AI", "AJ", "BJ", "BK", "BL", "BM", "CM", "CN", "NO", "NP"];
    let needVerifyThisRow = []
    for (let colIndex = 0; colIndex < columnToCheck.length; colIndex++) {
      for (let i = 6; i <= 32; i++) {
        needVerifyThisRow = []
        // Check each column are correct number format
        if (bsp[`${columnToCheck[colIndex]}${i}`] !== undefined && bsp[`${columnToCheck[colIndex]}${i}`]['v'] !== '') {
          if ((bsp[`${columnToCheck[colIndex]}${i}`]['v'].toString()).search("ref") > -1) {
            return {
              status: false,
              sheet: sheet,
              message: `សូមពិនិត្យមើលឥណទានអោយបានត្រឹមត្រូវនៅជួរឈរ ${columnToCheck[colIndex]} និងជួរដេកទី ${i}`
            }
          } else {
            if (isNaN(+(bsp[`${columnToCheck[colIndex]}${i}`]['v']))) {
              return {
                status: false,
                sheet: sheet,
                message: `ទឹកប្រាក់មិនត្រូវមានក្បៀស ឬដកឃ្លានៅជួរឈរ ${columnToCheck[colIndex]} និងជួរដេកទី ${i}`
              }
            }
          }
        }
      }
    }
  }

  // Validate activity data
  function validateActivity(activity) {
    let sheet = "Activity"
    for (let i = 4; i <= 562; i++) {
      // Required standard activity code
      if (activity[`D${i}`] !== undefined && activity[`D${i}`]['v'] !== '') {
        // Required standard activity code length must be equal 10
        if ((activity[`D${i}`]['v'].toString()).search('ACT') === 1 && activity[`D${i}`]['v'].length === 10) {
          // Column Output(E) must be not empty
          if (activity[`E${i}`] === undefined || activity[`E${i}`]['v'] === '') {
            return {
              status: false,
              sheet: sheet,
              message: `សូមបំពេញលទ្ធផលគ្រោងទុកនៅជួរឈរ E និងជួរដេកទី${i}`
            }
          }
          // Column Activity(F) must be not empty
          if (activity[`F${i}`] === undefined || activity[`F${i}`]['v'] === '') {
            return {
              status: false,
              sheet: sheet,
              message: `សូមបំពេញសកម្មភាពនៅជួរឈរ F និងជួរដេកទី${i}`
            }
          }
          // Column standard bsp indicator code(G) must be correct format(length=9, contain='ST')
          if (activity[`G${i}`] === undefined || activity[`G${i}`]['v'] === '') {
            return {
              status: false,
              sheet: sheet,
              message: `សូមជ្រើសរើសលេខកូដសូចនាករនៅជួរឈរ G និងជួរដេកទី${i}`
            }
          } else if ((activity[`G${i}`]['v'].toString()).search('ST') !== 1 && activity[`G${i}`]['v'].length !== 9) {
            return {
              status: false,
              sheet: sheet,
              message: `លេខកូដសូចនាករនៅជួរឈរ G និងជួរដេកទី${i} មិនត្រឹមត្រូវ`
            }
          }
          // Column Unit(H) must be not empty
          if (activity[`H${i}`] === undefined || activity[`H${i}`]['v'] === '') {
            return {
              status: false,
              sheet: sheet,
              message: `សូមបំពេញឯកតានៅជួរឈរ H និងជួរដេកទី${i}`
            }
          }

          // Column I,J,K,L must be at least one
          if (activity[`I${i}`] === undefined && activity[`J${i}`] === undefined && activity[`K${i}`] === undefined && activity[`L${i}`] === undefined) {
            return {
              status: false,
              sheet: sheet,
              message: `សូមបំពេញលទ្ធផលតាមក្របខ័ណ្ឌពេលវេលានៅជួរដេកទី${i} ក្នុងត្រីមាសណាមួយ`
            }
          }

          // Required column(M) who response
          if (activity[`M${i}`] === undefined || activity[`M${i}`]['v'] === '') {
            return {
              status: false,
              sheet: sheet,
              message: `សូមបំពេញឈ្មោះអ្នកទទួលខុសត្រូវនៅជួរឈរ M និងជួរដេកទី${i}`
            }
          }
        }
      }
    }
  }

  // Validate sub-activity data
  function validateSubActivity(sub_activity) {
    let sheet = "Activity Sub Level"
    for (let i = 4; i <= 562; i++) {
      // Required standard activity code
      if (sub_activity[`D${i}`] !== undefined && sub_activity[`D${i}`]['v'] !== '') {
        // Required standard activity code length must be equal 10
        if ((sub_activity[`D${i}`]['v'].toString()).search('ACT') === 1 && sub_activity[`D${i}`]['v'].length === 10) {
          // Column Output(E) must be not empty
          if (sub_activity[`E${i}`] === undefined || sub_activity[`E${i}`]['v'] === '') {
            return {
              status: false,
              sheet: sheet,
              message: `សូមបំពេញលទ្ធផលគ្រោងទុកនៅជួរឈរ E និងជួរដេកទី${i}`
            }
          }
          // Column Activity(F) must be not empty
          if (sub_activity[`F${i}`] === undefined || sub_activity[`F${i}`]['v'] === '') {
            return {
              status: false,
              sheet: sheet,
              message: `សូមបំពេញសកម្មភាពនៅជួរឈរ F និងជួរដេកទី${i}`
            }
          }
          // Column standard bsp indicator code(G) must be correct format(length=9, contain='ST')
          if (sub_activity[`G${i}`] === undefined || sub_activity[`G${i}`]['v'] === '') {
            return {
              status: false,
              sheet: sheet,
              message: `សូមជ្រើសរើសលេខកូដសូចនាករនៅជួរឈរ G និងជួរដេកទី${i}`
            }
          } else if ((sub_activity[`G${i}`]['v'].toString()).search('ST') !== 1 && sub_activity[`G${i}`]['v'].length !== 9) {
            return {
              status: false,
              sheet: sheet,
              message: `លេខកូដសូចនាករនៅជួរឈរ G និងជួរដេកទី${i} មិនត្រឹមត្រូវ`
            }
          }
          // Column Unit(H) must be not empty
          if (sub_activity[`H${i}`] === undefined || sub_activity[`H${i}`]['v'] === '') {
            return {
              status: false,
              sheet: sheet,
              message: `សូមបំពេញឯកតានៅជួរឈរ H និងជួរដេកទី${i}`
            }
          }

          // Column I,J,K,L must be at least one
          if (sub_activity[`I${i}`] === undefined && sub_activity[`J${i}`] === undefined && sub_activity[`K${i}`] === undefined && sub_activity[`L${i}`] === undefined) {
            return {
              status: false,
              sheet: sheet,
              message: `សូមបំពេញលទ្ធផលតាមក្របខ័ណ្ឌពេលវេលានៅជួរដេកទី${i} ក្នុងត្រីមាសណាមួយ`
            }
          }

          // Required column(M) who response
          if (sub_activity[`M${i}`] === undefined || sub_activity[`M${i}`]['v'] === '') {
            return {
              status: false,
              sheet: sheet,
              message: `សូមបំពេញឈ្មោះអ្នកទទួលខុសត្រូវនៅជួរឈរ M និងជួរដេកទី${i}`
            }
          }
        }
      }
    }
  }

  // Validate SOF data
  function validateSOF(sof) {
    let sheet = "SOF"
    let columnToCheck = ['C', 'D', 'E', 'F']
    let needVerifyThisRow = []
    for (let i = 9; i <= 1220; i++) {
      needVerifyThisRow = []
      if (sof[`C${i}`] && ['n', 's'].includes(sof[`C${i}`]['t']) && ((sof[`C${i}`]['v']).toString().toLowerCase()).search(',') > 0) {
        return {
          status: false,
          sheet: sheet,
          message: `អនុគណនីមិនត្រូវមានក្បៀសឡើយនៅជួរឈរ C និងជួរដេកទី ${i}`
        }
      }
      if (sof[`T${i}`] && typeof sof[`T${i}`]['v'].search == 'function') {
        if (sof[`T${i}`]['v'] === '') {
          columnToCheck.forEach((col) => {
            if (sof[`${col}${i}`] === undefined) {
              needVerifyThisRow.push(false)
            } else {
              if (col === 'D' || col === 'E') {
                if (sof[`${col}${i}`] !== undefined && sof[`${col}${i}`]['v'].toString().trim() === '') {
                  needVerifyThisRow.push(false)
                }
              }
              needVerifyThisRow.push(true)
            }
          })

          if (sof[`F${i}`] !== undefined && isNaN(+(sof[`F${i}`]['v']))) {
            return {
              status: false,
              sheet: sheet,
              message: `ទឹកប្រាក់មិនត្រូវមានក្បៀស ឬដកឃ្លានៅជួរឈរ F និងជួរដេកទី ${i}`
            }
          }

          if ((new Set(needVerifyThisRow)).size > 1) {
            return {
              status: false,
              sheet: sheet,
              message: `សូមពិនិត្យមើលការបញ្ចូលទិន្នន័យនៅជួរដេកទី${i} ឡើងវិញ`
            }
          }
        } else {
          return {
            status: false,
            sheet: sheet,
            message: `សូមពិនិត្យមើលការបញ្ចូលទិន្នន័យនៅជួរដេកទី${i} ឡើងវិញ`
          }
        }
      }
    }
  }

  // Validate Sub-SOF data
  function validateSubSOF(sub_sof) {
    let sheet = "SOF Sub Level"
    let columnToCheck = ['C', 'D', 'E', 'F']
    let needVerifyThisRow = []
    for (let i = 9; i <= 1220; i++) {
      needVerifyThisRow = []
      if (sub_sof[`C${i}`] && ['n', 's'].includes(sub_sof[`C${i}`]['t']) && ((sub_sof[`C${i}`]['v']).toString().toLowerCase()).search(',') > 0) {
        return {
          status: false,
          sheet: sheet,
          message: `អនុគណនីមិនត្រូវមានក្បៀសឡើយនៅជួរឈរ C និងជួរដេកទី ${i}`
        }
      }
      if (sub_sof[`T${i}`] && typeof sub_sof[`T${i}`]['v'].search == 'function') {
        if (sub_sof[`T${i}`]['v'] === '') {
          columnToCheck.forEach((col) => {
            if (sub_sof[`${col}${i}`] === undefined) {
              needVerifyThisRow.push(false)
            } else {
              needVerifyThisRow.push(true)
            }
          })

          if (sub_sof[`F${i}`] !== undefined && isNaN(+(sub_sof[`F${i}`]['v']))) {
            return {
              status: false,
              sheet: sheet,
              message: `ទឹកប្រាក់មិនត្រូវមានក្បៀស ឬដកឃ្លានៅជួរឈរ F និងជួរដេកទី ${i}`
            }
          }

          if ((new Set(needVerifyThisRow)).size > 1) {
            return {
              status: false,
              sheet: sheet,
              message: `សូមពិនិត្យមើលការបញ្ចូលទិន្នន័យនៅជួរដេកទី${i} ឡើងវិញ`
            }
          }
        } else {
          return {
            status: false,
            sheet: sheet,
            message: `សូមពិនិត្យមើលការបញ្ចូលទិន្នន័យនៅជួរដេកទី${i} ឡើងវិញ`
          }
        }
      }
    }
  }

  // Used to check if object has key when read data from excel.
  function has(obj, key) {
    for (let i = 0; i < key.length; i++) {
      if (obj[key[i]] === undefined) {
        return false
      }
    }
    return true
  }

  // Check if is RESOURCE_BLD(អគារធនធាន)
  function isRESOURCEBLD(sch_level) {
    return sch_level === "អគារធនធាន";
  }
</script>
<script>
  $(document).ready(function () {
    $(".readonly").keydown(function (e) {
      e.preventDefault();
    });
  });
  $(".select").prop("disabled", true);

</script><!-- Data Table js -->


<!-- Select2 js-->
<script src="https://sof.efmsmoeys.com/assets/plugins/select2/js/select2.min.js"></script>
<!-- izitoast -->
<script src="https://sof.efmsmoeys.com/izitoast/js/iziToast.min.js" type="text/javascript"></script>
<!-- Sweet-Alert js-->
<script src="https://sof.efmsmoeys.com/assets/plugins/sweet-alert/sweetalert.min.js"></script>
<!-- Bootstrap-datepicker -->
<script src="https://sof.efmsmoeys.com/assets/plugins/bootstrap-datepicker/bootstrap-datepicker.min.js"></script>
<script src="https://sof.efmsmoeys.com/assets/js/bootstrap-datepicker.kh.min.js"></script>
<!-- Timeline js-->
<script src="https://sof.efmsmoeys.com/assets/plugins/timeline/js/timeline.min.js"></script>
<!-- Timeline js-->
<script src="https://sof.efmsmoeys.com/assets/js/timline.js"></script>
<script src="https://sof.efmsmoeys.com/assets/js/jquery.formatCurrency-1.4.0.js"></script>
<script src="https://sof.efmsmoeys.com/assets/js/dof-js.js"></script>
<script src="https://sof.efmsmoeys.com/assets/js/modal.js"></script>
<!--- Pagination -->
<script src="https://sof.efmsmoeys.com/assets/plugins/pagination-js-ajax/pagination.min.js"></script>

<div class="modal" id="view_modal"></div>

<script>
    function verifynotzeronumber(input) {
        var num_length = $(input).val();
        if (num_length == "0") {
            swal({
                title: "Confirm",
                text: "ចំនួនគ្រូបង្រៀននិងអ្នកពាក់ព័ន្ធមិនអាចស្មើសូន្យបានទេ។",
                type: "error",
                confirmButtonColor: '#DD6B55',
                confirmButtonText: "Yes",
            });
            $(input).val('');
            $(input).focus();
        }
    }
    $('#view_modal').on('keyup', '.main_participant', function () {
        calculateMainMeeting();
    });
    $('#view_modal').on('keyup', '.sub_participant', function () {
        calculateSubMeeting();
    });
    function calculateMainMeeting() {
        var total_main_amount = 0;
        var total_main_participant = 0;

        $('#main_meeting_table > tbody > tr').each(function () {
            var id = $(this).data("id");

            $("tr.child-of-" + id).each(function () {
                var main_participant = parseFloat($(this).find('.main_participant').val().replace(/[^0-9.]/g, ""));
                var main_rate = parseFloat($(this).find('.main_rates').val().replace(/[^0-9.]/g, ""));
                var main_amount = (main_participant ? main_participant : 0) * (main_rate ? main_rate : 0);

                total_main_amount += (main_amount ? main_amount : 0);
                total_main_participant += (main_participant ? main_participant : 0);

                $(this).find('.main_amount').val(main_amount ? main_amount.toLocaleString() : '-');
                $('.main_total_amount').val(total_main_amount ? total_main_amount.toLocaleString() : '-');
                $('.main_total_participant').val(total_main_participant ? total_main_participant.toLocaleString() : '-');
            });
        });
    }
    function calculateSubMeeting() {
        var total_sub_amount = 0;
        var total_sub_participant = 0;

        $('#sub_meeting_table > tbody > tr').each(function () {
            var id = $(this).data("id");

            $("tr.child-of-" + id).each(function () {
                var sub_participant = parseFloat($(this).find('.sub_participant').val().replace(/[^0-9.]/g, ""));
                var sub_rate = parseFloat($(this).find('.sub_rates').val().replace(/[^0-9.]/g, ""));
                var sub_amount = (sub_participant ? sub_participant : 0) * (sub_rate ? sub_rate : 0);

                total_sub_amount += (sub_amount ? sub_amount : 0);
                total_sub_participant += (sub_participant ? sub_participant : 0);

                $(this).find('.sub_amount').val(sub_amount ? sub_amount.toLocaleString() : '-');
                $('.sub_total_amount').val(total_sub_amount ? total_sub_amount.toLocaleString() : '-');
                $('.sub_total_participant').val(total_sub_participant ? total_sub_participant.toLocaleString() : '-');
            });
        });
    }
    function calculationAnnual(ele, tableId, frmId, mainFrm) {
        ele.value = ele.value.replace(/[^0-9\.]/g, '');
        var val = ele.value;
        ele.value = val.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");

        calculateAmountAnnual(tableId, frmId);
        calculateTotalAnnual(tableId, frmId, mainFrm);
    }
    function calculateAmountAnnual(tableId, frmId) {
        var f_total = 0;
        var s_total = 0;
        var f_re_total = 0;
        var f_of_total = 0;
        var s_re_total = 0;
        var s_of_total = 0;

        $('#' + frmId + ' #' + tableId + '> tbody  > tr').each(function () {
            var f_amount = 0;
            var s_amount = 0;
            var amount_overall = 0;

            var unit_price = parseFloat($(this).find('.unit_price').val() ? $(this).find('.unit_price').val().replace(/,/g, '') : 0);
            var f_re_qty = parseFloat($(this).find('.f_re_qty').val() ? $(this).find('.f_re_qty').val().replace(/,/g, '') : 0);
            var f_of_qty = parseFloat($(this).find('.f_of_qty').val() ? $(this).find('.f_of_qty').val().replace(/,/g, '') : 0);
            var f_re_amount = (unit_price ? unit_price : 0) * (f_re_qty ? f_re_qty : 0);
            var f_of_amount = (unit_price ? unit_price : 0) * (f_of_qty ? f_of_qty : 0);

            f_amount = (f_re_amount + f_of_amount);
            f_total += (f_re_amount + f_of_amount);
            f_re_total += (f_re_amount);
            f_of_total += (f_of_amount);

            var s_re_qty = parseFloat($(this).find('.s_re_qty').val() ? $(this).find('.s_re_qty').val().replace(/,/g, '') : 0);
            var s_of_qty = parseFloat($(this).find('.s_of_qty').val() ? $(this).find('.s_of_qty').val().replace(/,/g, '') : 0);
            var s_re_amount = (unit_price ? unit_price : 0) * (s_re_qty ? s_re_qty : 0);
            var s_of_amount = (unit_price ? unit_price : 0) * (s_of_qty ? s_of_qty : 0);

            s_amount = (s_re_amount + s_of_amount);
            s_total += (s_re_amount + s_of_amount);
            s_re_total += (s_re_amount);
            s_of_total += (s_of_amount);

            $(this).find('.f_re_amount').val(f_re_amount ? f_re_amount.toLocaleString() : '-');
            $(this).find('.f_of_amount').val(f_of_amount ? f_of_amount.toLocaleString() : '-');
            $(this).find('.f_amount').val(f_amount ? f_amount.toLocaleString() : '-');

            $(this).find('.s_re_amount').val(s_re_amount ? s_re_amount.toLocaleString() : '-');
            $(this).find('.s_of_amount').val(s_of_amount ? s_of_amount.toLocaleString() : '-');
            $(this).find('.s_amount').val(s_amount ? s_amount.toLocaleString() : '-');

            amount_overall = (f_amount + s_amount);
            $(this).find('.amount_overall').val(amount_overall ? amount_overall.toLocaleString() : '-');
        });
    }
    function calculateTotalAnnual(tableId, frmId, mainFrm) {
        let eThis = $(`#${tableId}`)
        let school_level_tab_id = eThis.parents(".tab-pane")

        var grand_total = 0;
        var grand_first_re = 0;
        var grand_first_one = 0;
        var grand_first = 0;
        var grand_second_re = 0;
        var grand_second_one = 0;
        var grand_second = 0;
        var overall = 0;

        $('#' + frmId + ' #' + tableId + '> tbody  > tr').each(function () {
            var id = $(this).data("id");
            if (id) {
                $('#' + frmId + ' #' + tableId).find("tr.parent-of-" + id).each(function () {
                    var act_first_re = 0;
                    var act_first_one = 0;
                    var act_first = 0;
                    var act_second_re = 0;
                    var act_second_one = 0;
                    var act_second = 0;
                    var act_overall = 0;

                    $('#' + frmId + ' #' + tableId).find("tr.child-of-" + id).each(function () {
                        var subact_first_re = 0;
                        var subact_first_one = 0;
                        var subact_first = 0;
                        var subact_second_re = 0;
                        var subact_second_one = 0;
                        var subact_second = 0;
                        var subact_overall = 0;
                        var subid = $(this).data("subid");
                        if (subid) {
                            $('#' + frmId + ' #' + tableId).find("tr.child-of-" + subid).each(function (i) {
                                subact_first_re += parseFloat(($(this).find('.f_re_amount').val() && $(this).find('.f_re_amount').val() != '-') ? $(this).find('.f_re_amount').val().replace(/,/g, '') : 0);
                                subact_first_one += parseFloat(($(this).find('.f_of_amount').val() && $(this).find('.f_of_amount').val() != '-') ? $(this).find('.f_of_amount').val().replace(/,/g, '') : 0);

                                subact_first += parseFloat(($(this).find('.f_amount').val() && $(this).find('.f_amount').val() != '-') ? $(this).find('.f_amount').val().replace(/,/g, '') : 0);

                                subact_second_re += parseFloat(($(this).find('.s_re_amount').val() && $(this).find('.s_re_amount').val() != '-') ? $(this).find('.s_re_amount').val().replace(/,/g, '') : 0);
                                subact_second_one += parseFloat(($(this).find('.s_of_amount').val() && $(this).find('.s_of_amount').val() != '-') ? $(this).find('.s_of_amount').val().replace(/,/g, '') : 0);
                                subact_second += parseFloat(($(this).find('.s_amount').val() && $(this).find('.s_amount').val() != '-') ? $(this).find('.s_amount').val().replace(/,/g, '') : 0);
                            });
                        }

                        $(this).find('.subact_first_re').val(subact_first_re ? subact_first_re.toLocaleString() : '-');
                        $(this).find('.subact_first_one').val(subact_first_one ? subact_first_one.toLocaleString() : '-');
                        $(this).find('.subact_first').val(subact_first ? subact_first.toLocaleString() : '-');

                        $(this).find('.subact_second_re').val(subact_second_re ? subact_second_re.toLocaleString() : '-');
                        $(this).find('.subact_second_one').val(subact_second_one ? subact_second_one.toLocaleString() : '-');
                        $(this).find('.subact_second').val(subact_second ? subact_second.toLocaleString() : '-');

                        subact_overall = (subact_first + subact_second);
                        $(this).find('.subact_overall').val(subact_overall ? subact_overall.toLocaleString() : '-');

                        act_first_re += subact_first_re;
                        act_first_one += subact_first_one;
                        act_first += subact_first;
                        act_second_re += subact_second_re;
                        act_second_one += subact_second_one;
                        act_second += subact_second;
                    });

                    $(this).find('.act_first_re').val(act_first_re ? act_first_re.toLocaleString() : '-');
                    $(this).find('.act_first_one').val(act_first_one ? act_first_one.toLocaleString() : '-');
                    $(this).find('.act_first').val(act_first ? act_first.toLocaleString() : '-');

                    $(this).find('.act_second_re').val(act_second_re ? act_second_re.toLocaleString() : '-');
                    $(this).find('.act_second_one').val(act_second_one ? act_second_one.toLocaleString() : '-');
                    $(this).find('.act_second').val(act_second ? act_second.toLocaleString() : '-');

                    act_overall = (act_first + act_second);
                    $(this).find('.act_overall').val(act_overall ? act_overall.toLocaleString() : '-');

                    grand_first_re += act_first_re;
                    grand_first_one += act_first_one;
                    grand_first += act_first;
                    grand_second_re += act_second_re;
                    grand_second_one += act_second_one;
                    grand_second += act_second;
                });

                $('#' + frmId + ' #' + tableId).find("tr.total").find('.grand_first_re').val(grand_first_re ? grand_first_re.toLocaleString() : '-');
                $('#' + frmId + ' #' + tableId).find("tr.total").find('.grand_first_one').val(grand_first_one ? grand_first_one.toLocaleString() : '-');
                $('#' + frmId + ' #' + tableId).find("tr.total").find('.grand_first').val(grand_first ? grand_first.toLocaleString() : '-');

                $('#' + frmId + ' #' + tableId).find("tr.total").find('.grand_second_re').val(grand_second_re ? grand_second_re.toLocaleString() : '-');
                $('#' + frmId + ' #' + tableId).find("tr.total").find('.grand_second_one').val(grand_second_one ? grand_second_one.toLocaleString() : '-');
                $('#' + frmId + ' #' + tableId).find("tr.total").find('.grand_second').val(grand_second ? grand_second.toLocaleString() : '-');

                overall = (grand_first + grand_second);
                $('#' + frmId + ' #' + tableId).find("tr.total").find('.overall').val(overall ? overall.toLocaleString() : '-');
            }
        });
        grand_total = (grand_first + grand_second);
        school_level_tab_id.find(`#${mainFrm} .grand_total`).val(grand_total ? grand_total.toLocaleString() : '0');

        if (school_level_tab_id.find(".sof").val() != undefined) {
            let sof_package = school_level_tab_id.find(".sof").val().replace(/,/g, '');
            let remain_budget = (sof_package - grand_total).toLocaleString();
            school_level_tab_id.find(`#${mainFrm} .remain_budget`).val(remain_budget);
        }
    }
    function addBudgetPlanRow(tableId, rowId) {
        var row = $('#' + tableId + ' > tbody > tr#' + rowId).prev().closest('tr').clone(true).find('input[type="text"]').val('').end();
        row.closest('tr').find('.' + rowId).show();
        $('#' + tableId + ' > tbody > tr#' + rowId).before(row);
    }
    function removeBudgetPlanRow(ele, tableId, frmId, mainFrm) {
        swal(
            {
                title: "Confirm",
                text: "Do you really want to delete this data?",
                type: "warning",
                showCancelButton: true,
                confirmButtonText: "Yes",
                cancelButtonText: "No",
                buttons: {
                    cancel: {
                        className: "btn btn-info",
                    },
                    confirm: {
                        className: "btn btn-danger",
                    },
                },
            },
            function (isConfirm) {
                if (isConfirm) {
                    ele.closest('tr').remove();
                    calculateAmountAnnual(tableId, frmId);
                    calculateTotalAnnual(tableId, frmId, mainFrm);
                }
            }
        );
    }
</script>

<script>
    function showImportBudgetPlan(route)
    {
        $.ajaxSetup({
            headers: {
                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
            }
        });
        $.ajax({
            type: "get",
            url: route,
            dataType: 'json',
            beforeSend: function (xhr) {
                waiting.waitingUI('block');
            },
            success: function (result) {
                $("#view_modal").html(result.html);
                $("#view_modal").modal('toggle');
                waiting.waitingUI('none');
            },
            error: function (xhr) {
                let result = JSON.parse(xhr.responseText);
                switch (result.code) {
                    case 400:
                        let validate = "";
                        let i = 1;
                        for (const elem in result.errors) {
                            validate += `<br>${i}: ${elem}<br>`;
                            i++;
                        }
                        iziToast.error({
                            title: result.code,
                            titleSize: '18',
                            timeout: 8000,
                            message: result.validate,
                            titlmessageSize: '14',
                            maxWidth: 700,
                            position: 'topRight',
                            progressBarColor: '#fa0505',
                        });
                        waiting.waitingUI('none');
                        break;
                    case 500:
                        iziToast.info({
                            title: result.code,
                            titleSize: '18',
                            timeout: 8000,
                            message: result.message,
                            titlmessageSize: '14',
                            maxWidth: 700,
                            position: 'topRight',
                            progressBarColor: '#0099CC',
                        });
                        waiting.waitingUI('none');
                        break;
                    default:
                        iziToast.error({

                            title: result.code,
                            titleSize: '18',
                            timeout: 8000,
                            message: result.validate,
                            titlmessageSize: '14',
                            maxWidth: 700,
                            position: 'topRight',
                            progressBarColor: '#fa0505',
                        });
                        waiting.waitingUI('none');
                }
            }
        });
        return false;
    }
    function getBudgetPlan(route)
    {
        try {
            $.ajaxSetup({
                headers: {
                    'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
                }
            });
            $.ajax({
                type: "get",
                url: route,
                dataType: 'json',
                beforeSend: function (xhr) {
                    waiting.waitingUI('block');
                },
                success: function (result) {
                    if(result.table.annual_plan){
                        $('#p0').html(result.table.annual_plan);
                    }
                    if(result.table.meeting_plan){
                        $('#p1').html(result.table.meeting_plan);
                    }

                    $('#btn_submit').css('cursor', 'pointer').removeAttr('disabled');
                    waiting.waitingUI('none');
                },
                error: function (xhr) {
                    let result = JSON.parse(xhr.responseText);
                    switch (result.code) {
                        case 400:
                            let validate = "";
                            let i = 1;
                            for (const elem in result.errors) {
                                validate += `<br>${i}: ${elem}<br>`;
                                i++;
                            }
                            iziToast.error({
                                title: result.code,
                                titleSize: '18',
                                timeout: 8000,
                                message: result.message,
                                titlmessageSize: '14',
                                maxWidth: 700,
                                position: 'topRight',
                                progressBarColor: '#fa0505',
                            });
                            waiting.waitingUI('none');
                            break;
                        case 500:
                            iziToast.info({
                                title: result.code,
                                titleSize: '18',
                                timeout: 8000,
                                message: result.message,
                                titlmessageSize: '14',
                                maxWidth: 700,
                                position: 'topRight',
                                progressBarColor: '#0099CC',
                            });
                            waiting.waitingUI('none');
                            break;
                        default:
                            iziToast.error({
                                title: result.code,
                                titleSize: '18',
                                timeout: 8000,
                                message: result.message,
                                titlmessageSize: '14',
                                maxWidth: 700,
                                position: 'topRight',
                                progressBarColor: '#fa0505',
                            });
                            waiting.waitingUI('none');
                    }
                }
            });
            return true;
        } catch (error) {
            throw error;
        }
    }
    function storeBudgetPlan(formId, postTo)
    {
        try {
            // Validation
            var result = false;
            var sof = $('#bd0 .sof').val() != undefined ? $('#bd0 .sof').val().replace(/,/g, '') : 0;
            var sof_sub_level = $('#bd1 .sof').val() != undefined ? $('#bd1 .sof').val().replace(/,/g, '') : 0;
            var grand_sof = $('#bd0 .grand_total').val() != undefined ? $('#bd0 .grand_total').val().replace(/,/g, '') : 0;
            var grand_sof_sub_level = $('#bd1 .grand_total').val() != undefined ? $('#bd1 .grand_total').val().replace(/,/g, '') : 0;

            if (parseInt(grand_sof) % 100 || parseInt(grand_sof_sub_level) % 100) {
                last2Digit = parseInt(grand_sof) % 100 ? parseInt(grand_sof) % 100 : parseInt(grand_sof_sub_level) % 100;
                iziToast.error({
                    //color:'#f55742',
                    title: "Error",
                    titleSize: '18',
                    //titleColor: '',
                    timeout: 8000,
                    message: "Your budget must not have an extension " + last2Digit + "៛។",
                    titlmessageSize: '14',
                    //messageColor: '',
                    maxWidth: 700,
                    position: 'topRight',
                    progressBarColor: '#fa0505',
                });

                result = false;
                return false;
            }

            let check_input_of_main_level = $("#main_sof_annual_plan").parent().find(".bd input[id='txt_budget_plan']").val().replace(/,/g, '');
            let sub_annual_plan = $("#sub_sof_annual_plan").parent().find(".bd input[id='txt_budget_plan']").val();
            let check_input_of_sub_level = sub_annual_plan != undefined ? sub_annual_plan.replace(/,/g, '') : 0;

            if (check_input_of_main_level == 0 && check_input_of_sub_level == 0) {
                iziToast.error({
                    //color:'#f55742',
                    title: "Error",
                    titleSize: '18',
                    //titleColor: '',
                    timeout: 8000,
                    message: " Please Insert At Least First Row of Sub Act 1 ",
                    titlmessageSize: '14',
                    //messageColor: '',
                    maxWidth: 700,
                    position: 'topRight',
                    progressBarColor: '#fa0505',
                });
                result = false;
            } else {
                result = true;
            }

            // Store
            let formData = $("#" + formId).serialize();
            $.ajaxSetup({
                headers: {
                    'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
                }
            });
            $.ajax({
                type: "post",
                url: postTo,
                data: formData,
                dataType: 'json',
                beforeSend: function (xhr) {
                    waiting.waitingUI('block');
                },
                success: function (result) {
                    $('#view_modal').modal('toggle');
                    iziToast.success({
                        title: "",
                        titleSize: '18',
                        timeout: 8000,
                        message: "Data is successfully saved.",
                        titlmessageSize: '14',
                        position: 'topRight',
                        progressBarColor: '#007E33',
                    });
                    waiting.waitingUI('none');
                },
                error: function (xhr) {
                    let result = JSON.parse(xhr.responseText);
                    switch (result.code) {
                        case 400:
                            let validate = "";
                            let i = 1;
                            for (const elem in result.errors) {
                                validate += `<br>${i}: ${elem}<br>`;
                                i++;
                            }
                            iziToast.error({
                                title: result.code,
                                titleSize: '18',
                                timeout: 8000,
                                message: result.message,
                                titlmessageSize: '14',
                                maxWidth: 700,
                                position: 'topRight',
                                progressBarColor: '#fa0505',
                            });
                            break;
                        default:
                            iziToast.error({
                                title: result.code,
                                titleSize: '18',
                                timeout: 8000,
                                message: result.message,
                                titlmessageSize: '14',
                                maxWidth: 700,
                                position: 'topRight',
                                progressBarColor: '#fa0505',
                            });
                    }
                    waiting.waitingUI('none');
                }
            });
            return true;
        } catch (error) {
            throw error;
        }
    }
</script><a href="https://sof.efmsmoeys.com/feedback/index?auto-open-modal=true">
  <div class="feedback-button">
      <i class="bi bi-chat-right-text-fill icon"></i>
    </div>
</a>
<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
  }
  .feedback-button {
    position: fixed;
    bottom: 30px;
    right: 30px;
    background-color: green;
    color: #fff;
    padding: 15px 18px;
    border-radius: 50px;
    cursor: pointer;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  }
</style>
<script defer="" src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon="{&quot;version&quot;:&quot;2024.11.0&quot;,&quot;token&quot;:&quot;effdee0945ed4d898344287c9528f2cf&quot;,&quot;server_timing&quot;:{&quot;name&quot;:{&quot;cfCacheStatus&quot;:true,&quot;cfEdge&quot;:true,&quot;cfExtPri&quot;:true,&quot;cfL4&quot;:true,&quot;cfOrigin&quot;:true,&quot;cfSpeedBrain&quot;:true},&quot;location_startswith&quot;:null}}" crossorigin="anonymous"></script>


<script>
	function switchSystem(route) {
		window.open(route, '_blank')
	}
</script><div class="main-navbar-backdrop"></div></body></html>